
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. FDC Estimation &#8212; Streamflow Distribution Estimation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=192faf86" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/5_FDC_Estimation';</script>
    <script src="../_static/searchindex.js?v=c3f0b3c6"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Large Sample Comparison Results" href="6_Large_Sample_Results_Comparison.html" />
    <link rel="prev" title="4. Reference Distributions" href="4_Reference_Distributions.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Streamflow Distribution Estimation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Streamflow Distribution Estimation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    FDC Estimation Results Archive
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_data.html">1. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Methods.html">2. Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Predict_Runoff_Statistics.html">3. Predict Runoff Statistics from Catchment Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Reference_Distributions.html">4. Reference Distributions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. FDC Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_Large_Sample_Results_Comparison.html">6. Large Sample Comparison Results</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/dankovacek/distribution_estimation" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/dankovacek/distribution_estimation/issues/new?title=Issue%20on%20page%20%2Fnotebooks/5_FDC_Estimation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/5_FDC_Estimation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>FDC Estimation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-simulation">5.1. Non-Parametric Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-based-ensemble">5.1.1. Time-based ensemble</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-based-ensembles">5.1.2. Frequency-based ensembles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-on-k-nearest-neighbours">5.2. Notes on k-nearest neighbours</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-set-theoretic-foundations-of-strict-k-nn-concurrency-selection">5.2.1. Summary: Set-Theoretic Foundations of Strict k-NN Concurrency Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-theoretic-definition">5.2.1.1. Set-Theoretic Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#related-concepts">5.2.1.2. Related Concepts</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implication">5.2.1.3. Practical Implication</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-universal-parametric-prior">5.3. Define a universal parametric prior</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-uniform-prior">5.3.1. Global Uniform Prior</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-case-of-bad-kde-fit-due-to-sparse-support-and-precision-vestiges">5.4. Example case of bad KDE fit due to sparse support and precision vestiges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-complexity-of-searching-the-space-of-k-nearest-neighbours-for-the-optimal-ensemble">5.4.1. Compute the complexity of searching the space of k-nearest neighbours for the optimal ensemble</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-how-biased-a-quantile-based-spread-estimate-is-at-different-resolutions">5.4.2. Evaluate how biased a quantile-based spread estimate is at different resolutions</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="fdc-estimation">
<h1><span class="section-number">5. </span>FDC Estimation<a class="headerlink" href="#fdc-estimation" title="Link to this heading">#</a></h1>
<p>This notebook contains the main code for computing FDCs by the different methods.</p>
<p>It requires the runoff statistics to have been computed, and the results of the XGBoost prediction model (catchment attributes <span class="math notranslate nohighlight">\(\rightarrow\)</span> hydrologic signatures / runoff statistics) to have been processed in Notebook 3.  It also requires the pre-processing of reference (baseline) distributions by KDE for validation from Notebook 4.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">xgboost</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xgb</span>
<span class="n">xgb</span><span class="o">.</span><span class="n">config_context</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">utils.kde_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDEEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.knn_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">kNNEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.LSTM_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">LSTMFDCEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.parametric_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParametricFDCEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.fdc_estimator_context</span><span class="w"> </span><span class="kn">import</span> <span class="n">FDCEstimationContext</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.fdc_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">StationData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.evaluation_metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">EvaluationMetrics</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">utils.data_processing_functions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dpf</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.layouts</span><span class="w"> </span><span class="kn">import</span> <span class="n">gridplot</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">xyzservices.providers</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xyz</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;USGS&#39;</span><span class="p">][</span><span class="s1">&#39;USTopo&#39;</span><span class="p">]</span>
<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="ccee3523-b0a3-4bf8-9993-2ba72eaff4f3">Loading BokehJS ...</span>
    </div>
</div><script type="application/javascript">'use strict';
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded(error = null) {
    const el = document.getElementById("ccee3523-b0a3-4bf8-9993-2ba72eaff4f3");
    if (el != null) {
      const html = (() => {
        if (typeof root.Bokeh === "undefined") {
          if (error == null) {
            return "BokehJS is loading ...";
          } else {
            return "BokehJS failed to load.";
          }
        } else {
          const prefix = `BokehJS ${root.Bokeh.version}`;
          if (error == null) {
            return `${prefix} successfully loaded.`;
          } else {
            return `${prefix} <b>encountered errors</b> while loading and may not function as expected.`;
          }
        }
      })();
      el.innerHTML = html;

      if (error != null) {
        const wrapper = document.createElement("div");
        wrapper.style.overflow = "auto";
        wrapper.style.height = "5em";
        wrapper.style.resize = "vertical";
        const content = document.createElement("div");
        content.style.fontFamily = "monospace";
        content.style.whiteSpace = "pre-wrap";
        content.style.backgroundColor = "rgb(255, 221, 221)";
        content.textContent = error.stack ?? error.toString();
        wrapper.append(content);
        el.append(wrapper);
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(() => display_loaded(error), 100);
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.7.3.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
      try {
            for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }

      } catch (error) {display_loaded(error);throw error;
      }if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("ccee3523-b0a3-4bf8-9993-2ba72eaff4f3")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>

<span class="k">def</span><span class="w"> </span><span class="nf">warn_with_traceback</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">file</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warnings</span><span class="o">.</span><span class="n">formatwarning</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">showwarning</span> <span class="o">=</span> <span class="n">warn_with_traceback</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the catchment characteristics</span>
<span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;catchment_attributes_with_runoff_stats.csv&#39;</span>
<span class="n">attr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;official_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
<span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;log_drainage_area_km2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">])</span>
<span class="c1"># attr_df = attr_df[~attr_df[&#39;official_id&#39;].isin(exclude)]</span>
<span class="c1"># attr_df.columns = [c.lower() for c in attr_df.columns]</span>
<span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;tmean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;tmin&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">station_ids</span> <span class="o">=</span> <span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">stn_da_dict</span> <span class="o">=</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;official_id&#39;</span><span class="p">)[</span><span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="c1"># assert &#39;12414900&#39; in station_ids</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">station_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> monitored basins in the attribute set.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 1098 monitored basins in the attribute set.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># streamflow folder from (updated) HYSETS</span>
<span class="n">HYSETS_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/danbot/code/common_data/HYSETS&#39;</span><span class="p">)</span>
<span class="c1"># STREAMFLOW_DIR = HYSETS_DIR / &#39;streamflow&#39;</span>

<span class="n">hs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/HYSETS_watershed_properties.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Official_ID&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
<span class="n">hs_df</span> <span class="o">=</span> <span class="n">hs_df</span><span class="p">[</span><span class="n">hs_df</span><span class="p">[</span><span class="s1">&#39;Official_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">station_ids</span><span class="p">)]</span>
<span class="n">hs_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Watershed_ID</th>
      <th>Source</th>
      <th>Name</th>
      <th>Official_ID</th>
      <th>Centroid_Lat_deg_N</th>
      <th>Centroid_Lon_deg_E</th>
      <th>Drainage_Area_km2</th>
      <th>Drainage_Area_GSIM_km2</th>
      <th>Flag_GSIM_boundaries</th>
      <th>Flag_Artificial_Boundaries</th>
      <th>...</th>
      <th>Land_Use_Wetland_frac</th>
      <th>Land_Use_Water_frac</th>
      <th>Land_Use_Urban_frac</th>
      <th>Land_Use_Shrubs_frac</th>
      <th>Land_Use_Crops_frac</th>
      <th>Land_Use_Snow_Ice_frac</th>
      <th>Flag_Land_Use_Extraction</th>
      <th>Permeability_logk_m2</th>
      <th>Porosity_frac</th>
      <th>Flag_Subsoil_Extraction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>846</th>
      <td>847</td>
      <td>HYDAT</td>
      <td>CROWSNEST RIVER AT FRANK</td>
      <td>05AA008</td>
      <td>49.59732</td>
      <td>-114.4106</td>
      <td>402.6522</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0.0103</td>
      <td>0.0065</td>
      <td>0.0328</td>
      <td>0.0785</td>
      <td>0.0015</td>
      <td>0.0002</td>
      <td>1</td>
      <td>-15.543306</td>
      <td>0.170479</td>
      <td>1</td>
    </tr>
    <tr>
      <th>849</th>
      <td>850</td>
      <td>HYDAT</td>
      <td>CASTLE RIVER NEAR BEAVER MINES</td>
      <td>05AA022</td>
      <td>49.48866</td>
      <td>-114.1444</td>
      <td>820.6510</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0.0058</td>
      <td>0.0023</td>
      <td>0.0105</td>
      <td>0.1156</td>
      <td>0.0246</td>
      <td>0.0000</td>
      <td>1</td>
      <td>-15.929747</td>
      <td>0.150196</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 29 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the baseline PMFs from the previous notebook</span>
<span class="n">pmf_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span> <span class="o">/</span> <span class="s1">&#39;results&#39;</span> <span class="o">/</span> <span class="s1">&#39;baseline_distributions&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;bcub_pmfs.csv&#39;</span>
<span class="n">pmf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pmf_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pmf_stations</span> <span class="o">=</span> <span class="n">pmf_df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">station_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">station_ids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pmf_stations</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_ids</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1097
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exclude catchments found to be regulated (missed by QC)</span>
<span class="c1"># 12143700 isnot actually a dam, it&#39;s just basically a seepage monitoring station</span>
<span class="c1"># from a small catchment next to a dam </span>
<span class="n">dam_sites</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;12398000&#39;</span><span class="p">,</span> <span class="s1">&#39;12058800&#39;</span><span class="p">,</span> <span class="s1">&#39;12143700&#39;</span><span class="p">,</span> <span class="s1">&#39;12323760&#39;</span><span class="p">]</span> 
<span class="n">official_ids_to_include</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pmf_stations</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dam_sites</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve LSTM ensemble predictions</span>
<span class="n">LSTM_ensemble_result_folder</span> <span class="o">=</span> <span class="s1">&#39;/home/danbot/code/neuralhydrology/data/ensemble_results_20250514&#39;</span> <span class="c1"># based on mean NSE loss</span>
<span class="c1"># LSTM_ensemble_result_folder = &#39;/home/danbot/code/neuralhydrology/data/ensemble_results_20250627&#39; # based on 95% NSE loss</span>
<span class="n">lstm_result_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LSTM_ensemble_result_folder</span><span class="p">)</span>
<span class="n">lstm_result_stns</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lstm_result_files</span><span class="p">]</span>
<span class="k">assert</span> <span class="s1">&#39;12414900&#39;</span> <span class="ow">in</span> <span class="n">lstm_result_stns</span>

<span class="c1"># find any non-matching station ids in the lstm result files</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">lstm_result_stns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">station_ids</span><span class="p">:</span>
        <span class="c1"># try adding a leading zero</span>
        <span class="n">ending_in</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">station_ids</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">stn</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_in</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="s1">&#39;matches&#39;</span><span class="p">,</span> <span class="n">ending_in</span><span class="p">)</span>
        <span class="n">modified_stn</span> <span class="o">=</span> <span class="n">stn</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modified_stn</span> <span class="ow">in</span> <span class="n">station_ids</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found modified station id: </span><span class="si">{</span><span class="n">modified_stn</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: </span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1"> is in LSTM results but not in the station attributes.&#39;</span><span class="p">)</span>

<span class="c1"># filter for the common stations between BCUB region and LSTM-compatible (i.e. 1980-)</span>
<span class="n">daymet_concurrent_stations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">station_ids</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">lstm_result_stns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">official_ids_to_include</span><span class="p">))</span>
<span class="c1"># assert &#39;12414900&#39; in daymet_concurrent_stations</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">daymet_concurrent_stations</span><span class="p">)</span><span class="si">}</span><span class="s1"> monitored basins concurrent with LSTM ensemble results.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pmf_stations</span><span class="p">)</span><span class="si">}</span><span class="s1"> monitored basins with baseline PMFs.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: 12414900 is in LSTM results but not in the station attributes.
Warning: 15056030 is in LSTM results but not in the station attributes.
There are 719 monitored basins concurrent with LSTM ensemble results.
There are 1097 monitored basins with baseline PMFs.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">pmf_stations</span><span class="p">:</span>
    <span class="n">hs_data</span> <span class="o">=</span> <span class="n">hs_df</span><span class="p">[</span><span class="n">hs_df</span><span class="p">[</span><span class="s1">&#39;Official_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;DAM&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;RESERVOIR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import updated catchment polygons</span>
<span class="c1"># poly_fpath = os.path.join(os.path.join(&#39;data&#39;, f&#39;BCUB_watershed_attributes_updated_{rev_date}.csv&#39;))</span>
<span class="c1"># catchment_gdf = pd.read_csv(poly_fpath)</span>
<span class="c1"># catchment</span>
<span class="c1"># catchment_gdf = catchment_gdf[catchment_gdf[&#39;Official_ID&#39;].isin(station_ids)]</span>
<span class="c1"># print(len(catchment_gdf), &#39;catchments in the polygon set&#39;)</span>

<span class="c1"># import the license water extraction points</span>
<span class="c1"># dam_gdf = gpd.read_file(&#39;data/Dam_Points_20240103.gpkg&#39;)</span>
<span class="c1"># assert dam_gdf.crs == catchment_gdf.crs, &quot;Catchment and dam geometries must have the same CRS&quot;</span>
<span class="c1"># joined = gpd.sjoin(catchment_gdf, dam_gdf, how=&quot;inner&quot;, predicate=&quot;contains&quot;)</span>
<span class="c1"># Create a new boolean column &#39;contains_dam&#39; in catchment_gdf.</span>
<span class="c1"># If a polygon&#39;s index appears in the joined result, it means it contains at least one point.</span>
<span class="c1"># regulated = joined[&#39;Official_ID&#39;].values</span>
<span class="c1"># catchment_gdf[&quot;contains_dam&quot;] = catchment_gdf[&#39;Official_ID&#39;].apply(lambda x: x in regulated)</span>
<span class="c1"># n_regulated = catchment_gdf[&#39;contains_dam&#39;].sum()</span>
<span class="c1"># print(f&#39;{n_regulated}/{len(catchment_gdf)} catchments contain withdrawal licenses&#39;)</span>

<span class="c1"># # create dicts for easier access to &#39;official_id&#39;: &#39;drainage area&#39;, geometry, regulation status</span>
<span class="c1"># da_dict = attr_df[[&#39;official_id&#39;, &#39;drainage_area_km2&#39;]].copy().set_index(&#39;official_id&#39;).to_dict()[&#39;drainage_area_km2&#39;]</span>
<span class="c1"># dam_dict = catchment_gdf[[&#39;Official_ID&#39;, &#39;contains_dam&#39;]].copy().set_index(&#39;Official_ID&#39;).to_dict()[&#39;contains_dam&#39;]</span>
<span class="c1"># polygon_dict = catchment_gdf[[&#39;Official_ID&#39;, &#39;geometry&#39;]].copy().set_index(&#39;Official_ID&#39;).to_dict()[&#39;geometry&#39;]</span>

<span class="c1"># # add the centroid point geometry to the attributes dataframe</span>
<span class="c1"># attr_df = attr_df[attr_df[&#39;official_id&#39;].isin(catchment_gdf[&#39;Official_ID&#39;].values)].copy()</span>
<span class="c1"># centroids = attr_df.apply(lambda x: polygon_dict[x[&#39;official_id&#39;]].centroid, axis=1)</span>
<span class="c1"># attr_gdf = gpd.GeoDataFrame(attr_df, geometry=centroids, crs=catchment_gdf.crs)</span>
<span class="c1"># attr_gdf[&quot;contains_dam&quot;] = attr_gdf[&#39;official_id&#39;].apply(lambda x: dam_dict[x] if x in dam_dict else False)</span>
<span class="c1"># add the concurrency status as a boolean column</span>
<span class="c1"># attr_df[&#39;LSTM_concurrent&#39;] = attr_df[&#39;official_id&#39;].apply(lambda x: x in daymet_concurrent_stations)</span>
<span class="c1"># attr_df.reset_index(inplace=True, drop=True)</span>
<span class="c1"># print(f&#39;N network stations={len(attr_df)}&#39;)</span>
</pre></div>
</div>
</div>
</div>
<section id="non-parametric-simulation">
<h2><span class="section-number">5.1. </span>Non-Parametric Simulation<a class="headerlink" href="#non-parametric-simulation" title="Link to this heading">#</a></h2>
<section id="time-based-ensemble">
<h3><span class="section-number">5.1.1. </span>Time-based ensemble<a class="headerlink" href="#time-based-ensemble" title="Link to this heading">#</a></h3>
<p>A probability distribution <span class="math notranslate nohighlight">\(\hat p = f(\tilde x(t))\)</span> is estimated for a target (ungauged location) by a weighted mean of runoff time-series from k nearest neighbour stations, <span class="math notranslate nohighlight">\(\tilde x(t) = \textbf{X}(t)\cdot w\)</span> where <span class="math notranslate nohighlight">\(X(t) \in \mathbb{R}^{N \times k}\)</span> and <span class="math notranslate nohighlight">\(w \in \mathbb{R}^{k\times 1}\)</span> is a vector of k weights.  So <span class="math notranslate nohighlight">\(\hat p = f(\textbf{X}(t) \cdot w )\)</span>  Weights <span class="math notranslate nohighlight">\(w\)</span> are computed in three ways, described in the next subsection, and k-nearest neighbours are selected using the criteria defined below.  Each gauged station in the monitoring network is treated as an ungauged location to generate a large sample of simulations across hydrologically diverse catchments, or rather as many catchments as can be tested.</p>
</section>
<section id="frequency-based-ensembles">
<h3><span class="section-number">5.1.2. </span>Frequency-based ensembles<a class="headerlink" href="#frequency-based-ensembles" title="Link to this heading">#</a></h3>
<p>A simulated probability density function is estimated from observations of k nearest neighbour stations.  First, k simulated series are generated by equal unit area runoff , <span class="math notranslate nohighlight">\(\hat p = \hat P \cdot w\)</span> where <span class="math notranslate nohighlight">\(\hat P = [\hat p_1, \hat p_2, \cdots, \hat p_k]\)</span> and each <span class="math notranslate nohighlight">\(\hat p_i = f(X_i(t))\)</span>.</p>
<p>In both cases, the function <span class="math notranslate nohighlight">\(f \rightarrow \hat p(x)\)</span> represents kernel density estimation, which defines the probability density as $<span class="math notranslate nohighlight">\(\hat p(x) = \frac{1}{n \cdot h(x)} \sum_{i=1}^{n}K\left( \frac{x-x_i}{h(x)}\right)\)</span>$</p>
<p>Where <span class="math notranslate nohighlight">\(h(x)\)</span> reflects an adaptive kernel bandwidth that addresses vestiges of precision in the observed data to reflect the nature of streamflow as a continuous variable, and additionally incorporates piecewise linear model to represent overall measurement uncertainty.</p>
</section>
</section>
<section id="notes-on-k-nearest-neighbours">
<h2><span class="section-number">5.2. </span>Notes on k-nearest neighbours<a class="headerlink" href="#notes-on-k-nearest-neighbours" title="Link to this heading">#</a></h2>
<p>Time series streamflow records vary widely in their temporal coverage, and finding k-nearest neighbours presents a tradeoff between selecting nearest neighbours and maximizing the number of observations concurrent with the target.  From the literature, concurrency is assured by pre-selecting a subset of stations with continuous records over a common period of record, or by infilling gaps with k-nearest neighbours simulation.  Some kind of tradeoff must be made, and we aim to use a method that maximizes information content while minimizing the number of assumptions.  The following notes are intended to clarify the implications of using k-nearest neighbours to fill gaps in the time series.</p>
<ol class="arabic simple">
<li><p><strong>Infilled-by-kNN != Independent Proxy</strong>: If a gap in an observation record is inferred from neighbors, it becomes redundant in the ensemble and increases the weight of the other (k minus n) neighbours.  So at that time step, its influence is non-unique, and including it in the ensemble is functionally equivalent to using the same set of other proxies directly, or just reducing the ensemble size.</p></li>
<li><p><strong>Inflated Ensemble Size</strong>: Filling gaps by “nested” k-nearest neighbours inflates the expresed number of independent neighbors.  Comparing the effectiveness of ensemble simulations as a function of k is then misleading because the effective number of independent proxies is <em>at most</em> k.</p></li>
<li><p><strong>Information leakage risk</strong>: If you repeatedly use kNN to fill missing data from within the same pool, especially when simulating extreme values, you risk suppressing variability by biasing toward the central tendency of the ensemble.  This defeats one of the core motivations for kNN: to preserve structure and variability from observations at neighboring stations.</p></li>
</ol>
<p>To address the nuance above, we propose three time-based methods for selecting k-nearest neighbours beyond strictly nodes in the network.  The problem is related to the set-cover problem where the goal is to select a subset of stations that maximizes the intersection of their data availability over a specified time period.  The following sections outline the three methods for selecting k-nearest neighbours based on availability of concurrent data.</p>
<section id="summary-set-theoretic-foundations-of-strict-k-nn-concurrency-selection">
<h3><span class="section-number">5.2.1. </span>Summary: Set-Theoretic Foundations of Strict k-NN Concurrency Selection<a class="headerlink" href="#summary-set-theoretic-foundations-of-strict-k-nn-concurrency-selection" title="Link to this heading">#</a></h3>
<p>This problem is closely related to classic combinatorial and set-theoretic optimization problems.</p>
<section id="set-theoretic-definition">
<h4><span class="section-number">5.2.1.1. </span>Set-Theoretic Definition<a class="headerlink" href="#set-theoretic-definition" title="Link to this heading">#</a></h4>
<p>Let each column <span class="math notranslate nohighlight">\(( S_i \subseteq T )\)</span> represent the set of timestamps where station <span class="math notranslate nohighlight">\(( i )\)</span> has valid (non-NaN) data.<br />
Let <span class="math notranslate nohighlight">\(( \mathcal{S} = \{ S_1, S_2, \dots, S_n \} )\)</span> be the collection of all such subsets, sorted by proximity (e.g., distance or attribute similarity).<br />
The goal is to select a subset <span class="math notranslate nohighlight">\(( \mathcal{K} \subset \mathcal{S} )\)</span> such that:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(( |\mathcal{K}| = k )\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(( \bigcap_{S \in \mathcal{K}} S )\)</span> satisfies a temporal completeness constraint (e.g., ≥5 years with ≥10 observations in each of 12 months)</p></li>
</ul>
<p>This is a constrained subset selection problem on the intersection of sets.</p>
</section>
<section id="related-concepts">
<h4><span class="section-number">5.2.1.2. </span>Related Concepts<a class="headerlink" href="#related-concepts" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Concept</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Set Intersection Selection</p></td>
<td><p>Select ( k ) sets whose intersection satisfies a completeness constraint.</p></td>
</tr>
<tr class="row-odd"><td><p>Maximum Coverage under Cardinality Constraint</p></td>
<td><p>Choose ( k ) sets to maximize the coverage (or completeness) of their intersection.</p></td>
</tr>
<tr class="row-even"><td><p>Recursive k-Subset Validation</p></td>
<td><p>If the initial ( k ) sets fail, iteratively add more candidates and evaluate all ( \binom{k+1}{k} ) combinations, and so on.</p></td>
</tr>
<tr class="row-odd"><td><p>NP-Hard Nature</p></td>
<td><p>This problem is computationally hard and shares structure with the Set Cover and Maximum Coverage problems.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="practical-implication">
<h4><span class="section-number">5.2.1.3. </span>Practical Implication<a class="headerlink" href="#practical-implication" title="Link to this heading">#</a></h4>
<p>This formulation justifies using greedy or approximate subset selection strategies when exhaustively testing all combinations becomes computationally infeasible.</p>
</section>
</section>
</section>
<section id="define-a-universal-parametric-prior">
<h2><span class="section-number">5.3. </span>Define a universal parametric prior<a class="headerlink" href="#define-a-universal-parametric-prior" title="Link to this heading">#</a></h2>
<p>In order to fairly test how parametric and non-parametric pdf estimation methods compare to each other, we need a consistent way to deal with indeterminate cases where the simulated distribution does not provide support coverage of the “ground truth” observations.  I feel two ways about this: the KL divergence is the culprit here, and the problem could be avoided by choosing another divergence measure.  However the definintion of KL divergence in information theoretic terms of compression make it seem more foundational than other measures, but ultimately is this true?  Should we look to math statistics to make more direct links between f-divergences and what we use as a discriminant for a particular application?  Should we be more concerned about “Bayesian consistency” of the discriminant (or surrogate loss function) with the choice of divergence measure?</p>
<ol class="arabic simple">
<li><p><strong>Quantify the distribution of unsupported mass across all models</strong>.  It is important to describe the extent of the problem across the sample <strong>and</strong> across various methods.  i.e. discrete distributions have the issue of support coverage, but so do all methods!</p></li>
<li><p>Even in kNN / ensemble simulation approaches, the problem of incomplete support coverage necessitates assuming some prior probability.  The issue is that setting a uniform prior over the observed range takes advantage of information about the observed range.</p></li>
</ol>
<section id="global-uniform-prior">
<h3><span class="section-number">5.3.1. </span>Global Uniform Prior<a class="headerlink" href="#global-uniform-prior" title="Link to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[f(x) = \frac{1}{b-a}, \quad x\in (a, b) \text{ and } f(x) = 0 \text{ otherwise.}\]</div>
<div class="math notranslate nohighlight">
\[\int_a^b f(x)\text{dx} = 1\]</div>
<p>Given the target range is a sub interval <span class="math notranslate nohighlight">\((c, d) \subseteq (a, b)\)</span>, then the <strong>total</strong> prior probability mass over (c, d) is:</p>
<div class="math notranslate nohighlight">
\[M_\text{target} = \int_c^d \frac{1}{b-a}\text{dx} = \frac{d-c}{b-a}\]</div>
<p>Over the set of intervals <span class="math notranslate nohighlight">\(\Delta x_i\)</span> covering the <strong>target range</strong>, the probability mass associated with each interval (bin) is given by:</p>
<div class="math notranslate nohighlight">
\[\Delta x_i \frac{d-c}{b-a}\]</div>
<p>A desirable property of the prior is that it reflects the strength of belief in the model (data), where a smaller prior reflects stronger belief in the data/model and vice versa.  Dividing by the number of observations has such an effect, however it also makes for very small priors.  The consequence of very small priors is they have negligible effect on models that provide complete support coverage, and they severely penalize models that do not, resulting in a form of instability.  The very small prior creates a heavy tail in the distribution of a large sample of KL divergences, with further downstream effects in optimization.</p>
<p>A method that uses a prior with negligible effect on a model with complete support coverage and a very big effect on one without can be interpreted in a few ways:</p>
<ol class="arabic simple">
<li><p>Incomplete support coverage, or underspecification, is very heavily penalized.  The method does not tolerate a model that cannot predict the full observed range.</p></li>
<li><p>A <strong>proper</strong> probability distribution sums (discrete) or integrates (continuous) to 1.  Very small probabilities are in a sense associated with a high degree of certainty since they reflect the expectation of the system being observed in a particular state.</p></li>
<li><p>The penalty of underestimating a state frequency is that storing and transmitting information about the state requires (the log ratio) more bandwidth/disk space because it is assigned a longer bit string than the actual frequency calls for under optimal encoding.</p></li>
<li><p>Assigning a very small probability to a state …</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the predicted parameter results</span>
<span class="n">parameter_prediction_results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;parameter_prediction_results&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">predicted_params_fpath</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameter_prediction_results_folder</span><span class="p">,</span> <span class="s1">&#39;mean_parameter_predictions.csv&#39;</span><span class="p">)</span>
<span class="n">rdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">predicted_params_fpath</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;official_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
<span class="n">predicted_param_dict</span> <span class="o">=</span> <span class="n">rdf</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">predicted_param_dict</span><span class="p">[</span><span class="s1">&#39;0212414900&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;uar_mean_mean_predicted&#39;, &#39;uar_mean_actual&#39;, &#39;uar_std_mean_predicted&#39;, &#39;uar_std_actual&#39;, &#39;uar_median_mean_predicted&#39;, &#39;uar_median_actual&#39;, &#39;uar_mad_mean_predicted&#39;, &#39;uar_mad_actual&#39;, &#39;log_uar_mean_mean_predicted&#39;, &#39;log_uar_mean_actual&#39;, &#39;log_uar_std_mean_predicted&#39;, &#39;log_uar_std_actual&#39;, &#39;log_uar_median_mean_predicted&#39;, &#39;log_uar_median_actual&#39;, &#39;log_uar_mad_mean_predicted&#39;, &#39;log_uar_mad_actual&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">predicted_param_sample</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">al</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;log_uar_mean_mean_predicted&#39;</span><span class="p">,</span> <span class="s1">&#39;log_uar_std_mean_predicted&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$$\text{Log Mean UAR }(L/s/\text</span><span class="si">{km}</span><span class="s1">^2)$$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Log SD UAR }(L/s/\text</span><span class="si">{km}</span><span class="s1">^2)$$&#39;</span><span class="p">]):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">predicted_param_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">predicted_param_sample</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>
    <span class="c1"># plot the histogram of the mean_uar values</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># create a scatter plot of the predicted parameter vs the target parameter</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Predicted </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">al</span>
    <span class="n">f</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$P(x)$$&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># retrieve all the mean_uar values </span>

<span class="n">lt</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="eff807c9-aaeb-4472-b050-8d5c4d56595e" data-root-id="p1102" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"0baccef0-fb6c-4efd-a382-a2a6f70ce558":{"version":"3.7.3","title":"Bokeh Application","roots":[{"type":"object","name":"GridPlot","id":"p1102","attributes":{"rows":null,"cols":null,"toolbar":{"type":"object","name":"Toolbar","id":"p1101","attributes":{"tools":[{"type":"object","name":"ToolProxy","id":"p1095","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1025"},{"type":"object","name":"PanTool","id":"p1071"}]}},{"type":"object","name":"ToolProxy","id":"p1096","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1026","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1072","attributes":{"renderers":"auto"}}]}},{"type":"object","name":"ToolProxy","id":"p1097","attributes":{"tools":[{"type":"object","name":"BoxZoomTool","id":"p1027","attributes":{"dimensions":"both","overlay":{"type":"object","name":"BoxAnnotation","id":"p1028","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1034","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1033","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1073","attributes":{"dimensions":"both","overlay":{"type":"object","name":"BoxAnnotation","id":"p1074","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1080","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1079","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}}]}},{"type":"object","name":"SaveTool","id":"p1098"},{"type":"object","name":"ToolProxy","id":"p1099","attributes":{"tools":[{"type":"object","name":"ResetTool","id":"p1036"},{"type":"object","name":"ResetTool","id":"p1082"}]}},{"type":"object","name":"ToolProxy","id":"p1100","attributes":{"tools":[{"type":"object","name":"HelpTool","id":"p1037"},{"type":"object","name":"HelpTool","id":"p1083"}]}}]}},"children":[[{"type":"object","name":"Figure","id":"p1003","attributes":{"width":400,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1004"},"y_range":{"type":"object","name":"DataRange1d","id":"p1005"},"x_scale":{"type":"object","name":"LinearScale","id":"p1013"},"y_scale":{"type":"object","name":"LinearScale","id":"p1014"},"title":{"type":"object","name":"Title","id":"p1006","attributes":{"text":"Predicted log_uar_mean_mean_predicted"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1044","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1038","attributes":{"selected":{"type":"object","name":"Selection","id":"p1039","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1040"},"data":{"type":"map","entries":[["top",{"type":"ndarray","array":{"type":"bytes","data":"IPle8xx7hz8q+V7zHHt3P+A6h7ZVnJE/2DqHtlWcoT8l+V7zHHuXPwAAAAAAAAAA2DqHtlWckT8q+V7zHHunP01LUeejJLA/aiq9hQcUsz8g+V7zHHunPyr5XvMce6c/TUtR56MksD9dtzYw5Fm9PwanbP+V0b4/dLc2MORZvT9yKr2FBxTDPzwiWG3gz8M/O9jKkYBqyj8Y0GV5WSbLP+A6h7ZVnNE/oo1bsH6l1T+rZGI2u1DZPyr5XvMce9c/V6aK+fNx0z/z8Pna9TbYP0V9kX8wHdc/xDqHtlWc0T8Gp2z/ldHOP9CeB+dujc8/Bqds/5XRzj9hAcQLRL/GPz6v0Re9Fc4/PCJYbeDP0z9Xpor583HTP+LHAGEy4ss/NEtR56MksD8q+V7zHHuXPyr5XvMce4c/Kvle8xx7hz8="},"shape":[40],"dtype":"float64","order":"little"}],["left",{"type":"ndarray","array":{"type":"bytes","data":"h8+MNKeh+L8itiaj6xb2v76cwBEwjPO/WoNagHQB8b/q0+jdce3svyGhHLv61+e/WG5QmIPC4r8cdwjrGFrbv4wRcKUqL9G/8K9ef/EQvL/AzAUujzWpP1g+slZAo8o/vITxcI581z8m9URbvtPgP/InEX416eU/ulrdoKz+6j/BxtThEQrwPyXgOnPNlPI/ifmgBIkf9T/vEgeWRKr3P1MsbScANfo/t0XTuLu//D8dXzlKd0r/P0C8z22Z6gBA8siCNvcvAkCk1TX/VHUDQFbi6MeyugRACO+bkBAABkC8+05ZbkUHQG4IAiLMighAIBW16inQCUDSIWizhxULQIQuG3zlWgxANjvOREOgDUDoR4ENoeUOQE0qGmt/FRBAprBzTy64EEAAN80z3VoRQFm9JhiM/RFAskOA/DqgEkA="},"shape":[40],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"IrYmo+sW9r++nMARMIzzv1qDWoB0AfG/6tPo3XHt7L8hoRy7+tfnv1huUJiDwuK/HHcI6xha27+MEXClKi/Rv/CvXn/xELy/wMwFLo81qT9YPrJWQKPKP7yE8XCOfNc/JvVEW77T4D/yJxF+NenlP7pa3aCs/uo/wcbU4REK8D8l4DpzzZTyP4n5oASJH/U/7xIHlkSq9z9TLG0nADX6P7dF07i7v/w/HV85SndK/z9AvM9tmeoAQPLIgjb3LwJApNU1/1R1A0BW4ujHsroEQAjvm5AQAAZAvPtOWW5FB0BuCAIizIoIQCAVteop0AlA0iFos4cVC0CELht85VoMQDY7zkRDoA1A6EeBDaHlDkBNKhprfxUQQKawc08uuBBAADfNM91aEUBZvSYYjP0RQLJDgPw6oBJAC8rZ4OlCE0A="},"shape":[40],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1045","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1046"}}},"glyph":{"type":"object","name":"Quad","id":"p1041","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"fill_color":{"type":"value","value":"lightblue"}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1042","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1043","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1012","attributes":{"tools":[{"id":"p1025"},{"id":"p1026"},{"id":"p1027"},{"type":"object","name":"SaveTool","id":"p1035"},{"id":"p1036"},{"id":"p1037"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1020","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1021","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1022"},"axis_label":"$$P(x)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1023"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1015","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1016","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1017"},"axis_label":"$$\\text{Log Mean UAR }(L/s/\\text{km}^2)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1018"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"center":[{"type":"object","name":"Grid","id":"p1019","attributes":{"axis":{"id":"p1015"}}},{"type":"object","name":"Grid","id":"p1024","attributes":{"dimension":1,"axis":{"id":"p1020"}}},{"type":"object","name":"Legend","id":"p1047","attributes":{"label_text_font":"Bitstream Charter","label_text_font_size":"12pt","items":[{"type":"object","name":"LegendItem","id":"p1048","attributes":{"label":{"type":"value","value":""},"renderers":[{"id":"p1044"}]}}]}}]}},0,0],[{"type":"object","name":"Figure","id":"p1049","attributes":{"width":400,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1050"},"y_range":{"type":"object","name":"DataRange1d","id":"p1051"},"x_scale":{"type":"object","name":"LinearScale","id":"p1059"},"y_scale":{"type":"object","name":"LinearScale","id":"p1060"},"title":{"type":"object","name":"Title","id":"p1052","attributes":{"text":"Predicted log_uar_std_mean_predicted"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1090","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1084","attributes":{"selected":{"type":"object","name":"Selection","id":"p1085","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1086"},"data":{"type":"map","entries":[["top",{"type":"ndarray","array":{"type":"bytes","data":"8FgmWx7mqT+zwlzElmzTPw0kiybiIt0/iPYWWM014j+qih6tSbvsPxJAKrKIe/g/crwW/3SQ/z+uUCwK6hgBQEDW80gQ9f4/Cnamh8o48z+jwJqCi3jnP4739/jSL+A/x43Bj1qp1j/0j4PRZZ3SP/tYJlse5sk/x43Bj1qptj+PiT0MRMHOP7vCXMSWbLM/3I3Bj1qptj/kWCZbHuapPwAAAAAAAAAAAAAAAAAAAAARWSZbHuaZP+RYJlse5pk/q8JcxJZsoz8RWSZbHuaJP+RYJlse5pk/5FgmWx7miT/kWCZbHuaZPwAAAAAAAAAA5FgmWx7miT8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAORYJlse5ok/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5FgmWx7miT8="},"shape":[40],"dtype":"float64","order":"little"}],["left",{"type":"ndarray","array":{"type":"bytes","data":"TL8rH9Wy4j83v7WhzwDlPyK/PyTKTuc/Db/JpsSc6T/4vlMpv+rrP+O+3au5OO4/Z98zF1pD8D9c33hYV2rxP1LfvZlUkfI/SN8C21G48z8930ccT9/0PzLfjF1MBvY/KN/Rnkkt9z8e3xbgRlT4PxPfWyFEe/k/CN+gYkGi+j/+3uWjPsn7P/TeKuU78Pw/6d5vJjkX/j/e3rRnNj7/P2rvfNSZMgBAZW8fdRjGAEBg78EVl1kBQFpvZLYV7QFAVe8GV5SAAkBQb6n3EhQDQErvS5iRpwNARW/uOBA7BEBA75DZjs4EQDtvM3oNYgVANe/VGoz1BUAwb3i7CokGQCvvGlyJHAdAJm+9/AewB0Ah71+dhkMIQBtvAj4F1whAFu+k3oNqCUARb0d/Av4JQAvv6R+BkQpABm+MwP8kC0A="},"shape":[40],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"N7+1oc8A5T8ivz8kyk7nPw2/yabEnOk/+L5TKb/q6z/jvt2ruTjuP2ffMxdaQ/A/XN94WFdq8T9S372ZVJHyP0jfAttRuPM/Pd9HHE/f9D8y34xdTAb2Pyjf0Z5JLfc/Ht8W4EZU+D8T31shRHv5PwjfoGJBovo//t7loz7J+z/03irlO/D8P+nebyY5F/4/3t60ZzY+/z9q73zUmTIAQGVvH3UYxgBAYO/BFZdZAUBab2S2Fe0BQFXvBleUgAJAUG+p9xIUA0BK70uYkacDQEVv7jgQOwRAQO+Q2Y7OBEA7bzN6DWIFQDXv1RqM9QVAMG94uwqJBkAr7xpciRwHQCZvvfwHsAdAIe9fnYZDCEAbbwI+BdcIQBbvpN6DaglAEW9HfwL+CUAL7+kfgZEKQAZvjMD/JAtAAe8uYX64C0A="},"shape":[40],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1091","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1092"}}},"glyph":{"type":"object","name":"Quad","id":"p1087","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"fill_color":{"type":"value","value":"lightblue"}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1088","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1089","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1058","attributes":{"tools":[{"id":"p1071"},{"id":"p1072"},{"id":"p1073"},{"type":"object","name":"SaveTool","id":"p1081"},{"id":"p1082"},{"id":"p1083"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1066","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1067","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1068"},"axis_label":"$$P(x)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1069"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1061","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1062","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1063"},"axis_label":"$$\\text{Log SD UAR }(L/s/\\text{km}^2)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1064"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"center":[{"type":"object","name":"Grid","id":"p1065","attributes":{"axis":{"id":"p1061"}}},{"type":"object","name":"Grid","id":"p1070","attributes":{"dimension":1,"axis":{"id":"p1066"}}},{"type":"object","name":"Legend","id":"p1093","attributes":{"label_text_font":"Bitstream Charter","label_text_font_size":"12pt","items":[{"type":"object","name":"LegendItem","id":"p1094","attributes":{"label":{"type":"value","value":""},"renderers":[{"id":"p1090"}]}}]}}]}},0,1]]}}]}};
  const render_items = [{"docid":"0baccef0-fb6c-4efd-a382-a2a6f70ce558","roots":{"p1102":"eff807c9-aaeb-4472-b050-8d5c4d56595e"},"root_ids":["p1102"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FDCEstimatorRunner</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn_id</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">k_nearest</span><span class="p">,</span> <span class="n">parametric_target_cols</span><span class="p">,</span> <span class="n">estimator_classes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stn_id</span> <span class="o">=</span> <span class="n">stn_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ctx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_nearest</span> <span class="o">=</span> <span class="n">k_nearest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametric_target_cols</span> <span class="o">=</span> <span class="n">parametric_target_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_results_folders</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_readme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ESTIMATOR_CLASSES</span> <span class="o">=</span> <span class="n">estimator_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_strength</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">prior_strength</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_results_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create a results foder for each method if it doesn&#39;t exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;fdc_estimation_results&#39;</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
            <span class="n">method_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lstm&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lstm_rev_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">LSTM_ensemble_result_folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">method_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lstm_rev_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">method_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">method_folder</span><span class="p">)</span>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_readme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create a readme file in the results folder to list constraints</span>
        <span class="n">readme_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;This folder contains the results of the FDC estimation.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Methods evaluated: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># add the concurrency constraint and number of stations represented in the network</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">official_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">include_pre_1980_data</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uses only stations within Daymet input period of record / LSTM results: N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> stations in the network.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Global start date on streamflow data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">global_start_date</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uses all available network stations in the BCUB region (1950-2024): N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> stationsin the network.&#39;</span><span class="p">)</span>
                

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_reference_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kde</span> <span class="o">=</span> <span class="n">KDEEstimator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">baseline_log_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">log_dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_pmf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">baseline_pmf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">baseline_pdf</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">baseline_pmf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_pmf</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_save_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

 
    <span class="k">def</span><span class="w"> </span><span class="nf">run_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check the minimum number of years of overlap for all stations in self.ctx.overlap_dict</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_id</span><span class="si">}</span><span class="s1">_fdc_results.json&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lstm&#39;</span><span class="p">:</span>
                <span class="n">method_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lstm_rev_date</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span> <span class="n">method_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_id</span><span class="si">}</span><span class="s1">_fdc_results.json&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_file</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">StationData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">k_nearest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_nearest</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">parametric_target_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parametric_target_cols</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_reference_distributions</span><span class="p">()</span>

                <span class="n">eval_metrics</span> <span class="o">=</span> <span class="n">EvaluationMetrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">baseline_log_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">log_dx</span><span class="p">)</span>
                <span class="n">EstimatorClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ESTIMATOR_CLASSES</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
                <span class="n">estimator</span> <span class="o">=</span> <span class="n">EstimatorClass</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">eval_metrics</span> <span class="o">=</span> <span class="n">eval_metrics</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">run_estimators</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="c1"># except Exception as e:</span>
            <span class="c1">#     raise Exception(f&quot;  {method} estimator failed for {self.stn_id}: {str(e)}&quot;)</span>
                
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;mean_uar&#39;</span><span class="p">,</span> <span class="s1">&#39;sd_uar&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;mean_logx&#39;</span><span class="p">,</span> <span class="s1">&#39;sd_logx&#39;</span><span class="p">,</span> 
<span class="p">]</span>

<span class="c1"># from utils import FDCEstimationContext</span>
<span class="n">attr_df_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;catchment_attributes_with_runoff_stats.csv&#39;</span><span class="p">)</span>
<span class="n">LSTM_forcings_folder</span> <span class="o">=</span> <span class="s1">&#39;/home/danbot/neuralhydrology/data/BCUB_catchment_mean_met_forcings_20250320&#39;</span>
<span class="n">baseline_distribution_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;baseline_distributions&#39;</span><span class="p">)</span>
<span class="c1"># parameter_prediction_results_folder = os.path.join(&#39;data&#39;, &#39;parameter_prediction_results&#39;)</span>

<span class="n">methods</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;parametric&#39;</span><span class="p">,</span> <span class="s1">&#39;lstm&#39;</span><span class="p">,)</span><span class="c1"># &#39;knn&#39;,)</span>
<span class="c1"># methods = (&#39;knn&#39;,)</span>
<span class="n">k_nearest</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">include_pre_1980_data</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># use only stations with data 1980-present concurrent with Daymet</span>
<span class="n">daymet_start_date</span> <span class="o">=</span> <span class="s1">&#39;1980-01-01&#39;</span>  <span class="c1"># default start date for Daymet data</span>
<span class="k">if</span> <span class="n">include_pre_1980_data</span><span class="p">:</span>
    <span class="n">daymet_start_date</span> <span class="o">=</span> <span class="s1">&#39;1950-01-01&#39;</span>

<span class="n">processed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ESTIMATOR_CLASSES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;parametric&#39;</span><span class="p">:</span> <span class="n">ParametricFDCEstimator</span><span class="p">,</span>
    <span class="s1">&#39;lstm&#39;</span><span class="p">:</span> <span class="n">LSTMFDCEstimator</span><span class="p">,</span>
    <span class="s1">&#39;knn&#39;</span><span class="p">:</span> <span class="n">kNNEstimator</span><span class="p">,</span>
    <span class="c1"># add others here</span>
<span class="p">}</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;attr_df_fpath&#39;</span><span class="p">:</span> <span class="n">attr_df_fpath</span><span class="p">,</span>
    <span class="s1">&#39;LSTM_forcings_folder&#39;</span><span class="p">:</span> <span class="n">LSTM_forcings_folder</span><span class="p">,</span>
    <span class="s1">&#39;LSTM_ensemble_result_folder&#39;</span><span class="p">:</span> <span class="n">LSTM_ensemble_result_folder</span><span class="p">,</span>
    <span class="s1">&#39;include_pre_1980_data&#39;</span><span class="p">:</span> <span class="n">include_pre_1980_data</span><span class="p">,</span>  <span class="c1"># use only stations with data 1980-present concurrent with Daymet</span>
    <span class="s1">&#39;predicted_param_dict&#39;</span><span class="p">:</span> <span class="n">predicted_param_dict</span><span class="p">,</span>
    <span class="s1">&#39;divergence_measures&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DKL&#39;</span><span class="p">,</span> <span class="s1">&#39;EMD&#39;</span><span class="p">],</span>
    <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="mf">1e-12</span><span class="p">,</span>
    <span class="s1">&#39;min_flow&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span>
    <span class="s1">&#39;n_grid_points&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="o">**</span><span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;min_record_length&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s1">&#39;minimum_days_per_month&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;parametric_target_cols&#39;</span><span class="p">:</span> <span class="n">target_cols</span><span class="p">,</span>
    <span class="s1">&#39;all_station_ids&#39;</span><span class="p">:</span> <span class="n">official_ids_to_include</span><span class="p">,</span>
    <span class="s1">&#39;daymet_concurrent_stations&#39;</span><span class="p">:</span> <span class="n">daymet_concurrent_stations</span><span class="p">,</span>
    <span class="s1">&#39;baseline_distribution_folder&#39;</span><span class="p">:</span> <span class="n">baseline_distribution_folder</span><span class="p">,</span>
    <span class="s1">&#39;prior_strength&#39;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span>  <span class="c1"># prior strength for the Laplace fit</span>
<span class="p">}</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">FDCEstimationContext</span><span class="p">(</span><span class="o">**</span><span class="n">input_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Using all stations in the catchment data with a baseline PMF (validated): 1093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    ...overlap dict loaded from data/record_overlap_dict.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">processed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># missing_lstm_set1 =[&#39;12414900&#39;]</span>
<span class="c1"># missing_lstm_set2 = [&#39;10AA002&#39;]#, &#39;05BG002&#39;, &#39;08OA005&#39;, &#39;12172000&#39;, &#39;12173500&#39;, &#39;12422000&#39;]</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">process_fdcs</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">process_fdcs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing FDCs...&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">daymet_concurrent_stations</span><span class="p">:</span>
        <span class="c1"># if stn in missing_lstm_set2: # this station has no data in the LSTM ensemble results</span>
        <span class="c1">#     print(f&#39;    ...skipping {stn} due to naming issue.&#39;)</span>
        <span class="c1">#     continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estimating FDC for </span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">predicted_param_dict</span><span class="p">[</span><span class="n">stn</span><span class="p">][</span><span class="s1">&#39;uar_mean_actual&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;   </span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">: actual mean UAR=</span><span class="si">{</span><span class="n">foo</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> L/s/km2&#39;</span><span class="p">)</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">FDCEstimatorRunner</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">k_nearest</span><span class="p">,</span> <span class="n">target_cols</span><span class="p">,</span> <span class="n">ESTIMATOR_CLASSES</span><span class="p">)</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run_selected</span><span class="p">()</span>
        <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="n">unit_time</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">official_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> stations in </span><span class="si">{</span><span class="n">unit_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds per station&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing FDCs...
Estimating FDC for 08NM146...
   08NM146: actual mean UAR=4.93 L/s/km2
Estimating FDC for 12069550...
   12069550: actual mean UAR=27.51 L/s/km2
Estimating FDC for 10GC003...
   10GC003: actual mean UAR=4.44 L/s/km2
Estimating FDC for 08HF012...
   08HF012: actual mean UAR=97.63 L/s/km2
Estimating FDC for 08NM134...
   08NM134: actual mean UAR=4.28 L/s/km2
Estimating FDC for 12324590...
   12324590: actual mean UAR=4.14 L/s/km2
Estimating FDC for 12090500...
   12090500: actual mean UAR=5.70 L/s/km2
Estimating FDC for 07FB001...
   07FB001: actual mean UAR=16.07 L/s/km2
Estimating FDC for 12150800...
   12150800: actual mean UAR=68.12 L/s/km2
Estimating FDC for 08EG011...
   08EG011: actual mean UAR=63.20 L/s/km2
Processed 10/1093 stations in 0.00 seconds per station
Estimating FDC for 08NG065...
   08NG065: actual mean UAR=14.98 L/s/km2
Estimating FDC for 12396500...
   12396500: actual mean UAR=11.51 L/s/km2
Estimating FDC for 12101500...
   12101500: actual mean UAR=38.97 L/s/km2
Estimating FDC for 05AA035...
   05AA035: actual mean UAR=7.58 L/s/km2
Estimating FDC for 05AD003...
   05AD003: actual mean UAR=29.08 L/s/km2
Estimating FDC for 08LA007...
   08LA007: actual mean UAR=47.05 L/s/km2
Estimating FDC for 08NP001...
   08NP001: actual mean UAR=23.63 L/s/km2
Estimating FDC for 12340000...
   12340000: actual mean UAR=7.67 L/s/km2
Estimating FDC for 08ND012...
   08ND012: actual mean UAR=41.96 L/s/km2
Estimating FDC for 08NL076...
   08NL076: actual mean UAR=6.93 L/s/km2
Processed 20/1093 stations in 0.00 seconds per station
Estimating FDC for 09AD001...
   09AD001: actual mean UAR=11.35 L/s/km2
Estimating FDC for 08HF013...
   08HF013: actual mean UAR=82.77 L/s/km2
Estimating FDC for 10FA002...
   10FA002: actual mean UAR=4.47 L/s/km2
Estimating FDC for 12413210...
   12413210: actual mean UAR=19.74 L/s/km2
Estimating FDC for 08HB086...
   08HB086: actual mean UAR=178.96 L/s/km2
Estimating FDC for 12189500...
   12189500: actual mean UAR=68.19 L/s/km2
Estimating FDC for 08KA009...
   08KA009: actual mean UAR=33.24 L/s/km2
Estimating FDC for 08FA002...
   08FA002: actual mean UAR=83.05 L/s/km2
Estimating FDC for 08LF084...
   08LF084: actual mean UAR=2.88 L/s/km2
Estimating FDC for 08LA028...
   08LA028: actual mean UAR=9.76 L/s/km2
Processed 30/1093 stations in 0.00 seconds per station
Estimating FDC for 12143900...
   12143900: actual mean UAR=124.96 L/s/km2
Estimating FDC for 12438900...
   12438900: actual mean UAR=1.87 L/s/km2
Estimating FDC for 12414500...
   12414500: actual mean UAR=24.96 L/s/km2
Estimating FDC for 08NE006...
   08NE006: actual mean UAR=42.13 L/s/km2
Estimating FDC for 12303100...
   12303100: actual mean UAR=25.38 L/s/km2
Estimating FDC for 12036000...
   12036000: actual mean UAR=127.67 L/s/km2
Estimating FDC for 08MH166...
   08MH166: actual mean UAR=122.48 L/s/km2
Estimating FDC for 08HB069...
   08HB069: actual mean UAR=92.12 L/s/km2
Estimating FDC for 08GD007...
   08GD007: actual mean UAR=36.62 L/s/km2
Estimating FDC for 08MH147...
   08MH147: actual mean UAR=119.83 L/s/km2
Processed 40/1093 stations in 0.00 seconds per station
Estimating FDC for 08NE114...
   08NE114: actual mean UAR=28.59 L/s/km2
Estimating FDC for 12459000...
   12459000: actual mean UAR=34.00 L/s/km2
Estimating FDC for 12352500...
   12352500: actual mean UAR=8.74 L/s/km2
Estimating FDC for 09AG003...
   09AG003: actual mean UAR=7.73 L/s/km2
Estimating FDC for 08HB074...
   08HB074: actual mean UAR=82.90 L/s/km2
Estimating FDC for 08FB005...
   08FB005: actual mean UAR=62.76 L/s/km2
Estimating FDC for 12095000...
   12095000: actual mean UAR=32.11 L/s/km2
Estimating FDC for 08NM173...
   08NM173: actual mean UAR=1.88 L/s/km2
Estimating FDC for 12044900...
   12044900: actual mean UAR=73.43 L/s/km2
Estimating FDC for 05BF018...
   05BF018: actual mean UAR=16.86 L/s/km2
Processed 50/1093 stations in 0.00 seconds per station
Estimating FDC for 12212390...
   12212390: actual mean UAR=26.32 L/s/km2
Estimating FDC for 08NH007...
   08NH007: actual mean UAR=35.77 L/s/km2
Estimating FDC for 08GA079...
   08GA079: actual mean UAR=106.44 L/s/km2
Estimating FDC for 08NL071...
   08NL071: actual mean UAR=25.63 L/s/km2
Estimating FDC for 08LA001...
   08LA001: actual mean UAR=22.14 L/s/km2
Estimating FDC for 12331800...
   12331800: actual mean UAR=3.25 L/s/km2
Estimating FDC for 08MH018...
   08MH018: actual mean UAR=30.17 L/s/km2
Estimating FDC for 08KH019...
   08KH019: actual mean UAR=6.58 L/s/km2
Estimating FDC for 12039500...
   12039500: actual mean UAR=122.54 L/s/km2
Estimating FDC for 08OA002...
   08OA002: actual mean UAR=63.14 L/s/km2
Processed 60/1093 stations in 0.00 seconds per station
Estimating FDC for 10ED007...
   10ED007: actual mean UAR=7.64 L/s/km2
Estimating FDC for 05DA009...
   05DA009: actual mean UAR=28.16 L/s/km2
Estimating FDC for 08NB018...
   08NB018: actual mean UAR=45.23 L/s/km2
Estimating FDC for 15087590...
   15087590: actual mean UAR=53.48 L/s/km2
Estimating FDC for 09AC007...
   09AC007: actual mean UAR=3.29 L/s/km2
Estimating FDC for 12134500...
   12134500: actual mean UAR=83.28 L/s/km2
Estimating FDC for 07EA004...
   07EA004: actual mean UAR=13.91 L/s/km2
Estimating FDC for 09AA006...
   09AA006: actual mean UAR=14.75 L/s/km2
Estimating FDC for 08EE008...
   08EE008: actual mean UAR=14.00 L/s/km2
Estimating FDC for 07ED003...
   07ED003: actual mean UAR=12.40 L/s/km2
Processed 70/1093 stations in 0.00 seconds per station
Estimating FDC for 08CA002...
   08CA002: actual mean UAR=16.79 L/s/km2
Estimating FDC for 08LF080...
   08LF080: actual mean UAR=1.30 L/s/km2
Estimating FDC for 08HA072...
   08HA072: actual mean UAR=52.64 L/s/km2
Estimating FDC for 12158010...
   12158010: actual mean UAR=10.08 L/s/km2
Estimating FDC for 15100000...
   15100000: actual mean UAR=162.26 L/s/km2
Estimating FDC for 05AA022...
   05AA022: actual mean UAR=18.70 L/s/km2
Estimating FDC for 12144500...
   12144500: actual mean UAR=78.46 L/s/km2
Estimating FDC for 10EA003...
   10EA003: actual mean UAR=11.36 L/s/km2
Estimating FDC for 08EG017...
   08EG017: actual mean UAR=45.74 L/s/km2
Estimating FDC for 07EC004...
   07EC004: actual mean UAR=18.11 L/s/km2
Processed 80/1093 stations in 0.00 seconds per station
Estimating FDC for 08LE027...
   08LE027: actual mean UAR=45.77 L/s/km2
Estimating FDC for 07GD001...
   07GD001: actual mean UAR=2.19 L/s/km2
Estimating FDC for 08BB005...
   08BB005: actual mean UAR=23.53 L/s/km2
Estimating FDC for 15058700...
   15058700: actual mean UAR=111.95 L/s/km2
Estimating FDC for 12323840...
   12323840: actual mean UAR=3.66 L/s/km2
Estimating FDC for 08HA016...
   08HA016: actual mean UAR=23.17 L/s/km2
Estimating FDC for 08CF001...
   08CF001: actual mean UAR=17.92 L/s/km2
Estimating FDC for 08NJ160...
   08NJ160: actual mean UAR=25.90 L/s/km2
Estimating FDC for 08EB005...
   08EB005: actual mean UAR=28.58 L/s/km2
Estimating FDC for 08NJ013...
   08NJ013: actual mean UAR=27.71 L/s/km2
Processed 90/1093 stations in 0.00 seconds per station
Estimating FDC for 07EA002...
   07EA002: actual mean UAR=21.22 L/s/km2
Estimating FDC for 08NM142...
   08NM142: actual mean UAR=4.26 L/s/km2
Estimating FDC for 07BC002...
   07BC002: actual mean UAR=2.56 L/s/km2
Estimating FDC for 10CC002...
   10CC002: actual mean UAR=5.95 L/s/km2
Estimating FDC for 08LB047...
   08LB047: actual mean UAR=34.13 L/s/km2
Estimating FDC for 12383500...
   12383500: actual mean UAR=16.61 L/s/km2
Estimating FDC for 12201960...
   12201960: actual mean UAR=32.89 L/s/km2
Estimating FDC for 12206900...
   12206900: actual mean UAR=61.89 L/s/km2
Estimating FDC for 08NH016...
   08NH016: actual mean UAR=18.04 L/s/km2
Estimating FDC for 08NN015...
   08NN015: actual mean UAR=14.44 L/s/km2
Processed 100/1093 stations in 0.00 seconds per station
Estimating FDC for 08LE077...
   08LE077: actual mean UAR=15.63 L/s/km2
Estimating FDC for 12209490...
   12209490: actual mean UAR=66.44 L/s/km2
Estimating FDC for 08AB001...
   08AB001: actual mean UAR=14.69 L/s/km2
Estimating FDC for 08JE001...
   08JE001: actual mean UAR=9.25 L/s/km2
Estimating FDC for 08KF001...
   08KF001: actual mean UAR=1.50 L/s/km2
Estimating FDC for 12302055...
   12302055: actual mean UAR=5.89 L/s/km2
Estimating FDC for 08MH056...
   08MH056: actual mean UAR=65.16 L/s/km2
Estimating FDC for 08KA005...
   08KA005: actual mean UAR=29.18 L/s/km2
Estimating FDC for 08LF099...
   08LF099: actual mean UAR=2.55 L/s/km2
Estimating FDC for 10AC004...
   10AC004: actual mean UAR=10.95 L/s/km2
Processed 110/1093 stations in 0.00 seconds per station
Estimating FDC for 08GE002...
   08GE002: actual mean UAR=52.19 L/s/km2
Estimating FDC for 12433561...
   12433561: actual mean UAR=1.67 L/s/km2
Estimating FDC for 08NH032...
   08NH032: actual mean UAR=24.45 L/s/km2
Estimating FDC for 12439300...
   12439300: actual mean UAR=0.57 L/s/km2
Estimating FDC for 15052000...
   15052000: actual mean UAR=157.92 L/s/km2
Estimating FDC for 08NE074...
   08NE074: actual mean UAR=25.63 L/s/km2
Estimating FDC for 12324400...
   12324400: actual mean UAR=3.24 L/s/km2
Estimating FDC for 08MB005...
   08MB005: actual mean UAR=5.38 L/s/km2
Estimating FDC for 12097500...
   12097500: actual mean UAR=30.70 L/s/km2
Estimating FDC for 12100490...
   12100490: actual mean UAR=37.24 L/s/km2
Processed 120/1093 stations in 0.00 seconds per station
Estimating FDC for 10CD005...
   10CD005: actual mean UAR=7.70 L/s/km2
Estimating FDC for 08KH031...
   08KH031: actual mean UAR=13.67 L/s/km2
Estimating FDC for 08HA001...
   08HA001: actual mean UAR=53.26 L/s/km2
Estimating FDC for 08NN002...
   08NN002: actual mean UAR=14.98 L/s/km2
Estimating FDC for 12025000...
   12025000: actual mean UAR=36.60 L/s/km2
Estimating FDC for 12389500...
   12389500: actual mean UAR=7.38 L/s/km2
Estimating FDC for 07AG007...
   07AG007: actual mean UAR=5.70 L/s/km2
Estimating FDC for 07EC002...
   07EC002: actual mean UAR=16.04 L/s/km2
Estimating FDC for 15085100...
   15085100: actual mean UAR=79.72 L/s/km2
Estimating FDC for 08JB003...
   08JB003: actual mean UAR=4.87 L/s/km2
Processed 130/1093 stations in 0.00 seconds per station
Estimating FDC for 12142000...
   12142000: actual mean UAR=87.91 L/s/km2
Estimating FDC for 10AA005...
   10AA005: actual mean UAR=7.65 L/s/km2
Estimating FDC for 05BJ010...
   05BJ010: actual mean UAR=9.08 L/s/km2
Estimating FDC for 15109048...
   15109048: actual mean UAR=29.02 L/s/km2
Estimating FDC for 08NN021...
   08NN021: actual mean UAR=10.25 L/s/km2
Estimating FDC for 12079000...
   12079000: actual mean UAR=30.54 L/s/km2
Estimating FDC for 07EE010...
   07EE010: actual mean UAR=11.97 L/s/km2
Estimating FDC for 12323600...
   12323600: actual mean UAR=1.74 L/s/km2
Estimating FDC for 08NM133...
   08NM133: actual mean UAR=2.90 L/s/km2
Estimating FDC for 12323700...
   12323700: actual mean UAR=5.17 L/s/km2
Processed 140/1093 stations in 0.00 seconds per station
Estimating FDC for 12388400...
   12388400: actual mean UAR=8.41 L/s/km2
Estimating FDC for 10BE010...
   10BE010: actual mean UAR=15.23 L/s/km2
Estimating FDC for 07GH002...
   07GH002: actual mean UAR=4.36 L/s/km2
Estimating FDC for 12115700...
   12115700: actual mean UAR=57.08 L/s/km2
Estimating FDC for 07EA007...
   07EA007: actual mean UAR=17.93 L/s/km2
Estimating FDC for 08NB019...
   08NB019: actual mean UAR=36.84 L/s/km2
Estimating FDC for 10EC002...
   10EC002: actual mean UAR=11.04 L/s/km2
Estimating FDC for 12433200...
   12433200: actual mean UAR=3.70 L/s/km2
Estimating FDC for 15087545...
   15087545: actual mean UAR=109.90 L/s/km2
Estimating FDC for 08LG055...
   08LG055: actual mean UAR=3.10 L/s/km2
Processed 150/1093 stations in 0.00 seconds per station
Estimating FDC for 07FD007...
   07FD007: actual mean UAR=2.55 L/s/km2
Estimating FDC for 08MH001...
   08MH001: actual mean UAR=55.18 L/s/km2
Estimating FDC for 12115000...
   12115000: actual mean UAR=69.02 L/s/km2
Estimating FDC for 12353000...
   12353000: actual mean UAR=6.73 L/s/km2
Estimating FDC for 12114500...
   12114500: actual mean UAR=69.64 L/s/km2
Estimating FDC for 05DA010...
   05DA010: actual mean UAR=20.75 L/s/km2
Estimating FDC for 12035000...
   12035000: actual mean UAR=76.93 L/s/km2
Estimating FDC for 10EB001...
   10EB001: actual mean UAR=15.95 L/s/km2
Estimating FDC for 12413500...
   12413500: actual mean UAR=22.89 L/s/km2
Estimating FDC for 10CB001...
   10CB001: actual mean UAR=11.95 L/s/km2
Processed 160/1093 stations in 0.00 seconds per station
Estimating FDC for 09AA007...
   09AA007: actual mean UAR=2.34 L/s/km2
Estimating FDC for 12202420...
   12202420: actual mean UAR=15.15 L/s/km2
Estimating FDC for 05AA023...
   05AA023: actual mean UAR=8.86 L/s/km2
Estimating FDC for 10AA004...
   10AA004: actual mean UAR=10.28 L/s/km2
Estimating FDC for 07HC001...
   07HC001: actual mean UAR=2.82 L/s/km2
Estimating FDC for 08LB024...
   08LB024: actual mean UAR=5.44 L/s/km2
Estimating FDC for 05DC006...
   05DC006: actual mean UAR=8.45 L/s/km2
Estimating FDC for 12374250...
   12374250: actual mean UAR=5.33 L/s/km2
Estimating FDC for 12415350...
   12415350: actual mean UAR=13.97 L/s/km2
Estimating FDC for 08MG005...
   08MG005: actual mean UAR=59.40 L/s/km2
Processed 170/1093 stations in 0.00 seconds per station
Estimating FDC for 08GA071...
   08GA071: actual mean UAR=87.94 L/s/km2
Estimating FDC for 08HE008...
   08HE008: actual mean UAR=82.38 L/s/km2
Estimating FDC for 09AA013...
   09AA013: actual mean UAR=16.23 L/s/km2
Estimating FDC for 12102190...
   12102190: actual mean UAR=24.65 L/s/km2
Estimating FDC for 05BF019...
   05BF019: actual mean UAR=10.93 L/s/km2
Estimating FDC for 12324200...
   12324200: actual mean UAR=2.91 L/s/km2
Estimating FDC for 10BE006...
   10BE006: actual mean UAR=11.41 L/s/km2
Estimating FDC for 08CC001...
   08CC001: actual mean UAR=20.64 L/s/km2
Estimating FDC for 12082500...
   12082500: actual mean UAR=64.48 L/s/km2
Estimating FDC for 12210500...
   12210500: actual mean UAR=66.09 L/s/km2
Processed 180/1093 stations in 0.00 seconds per station
Estimating FDC for 12210900...
   12210900: actual mean UAR=24.77 L/s/km2
Estimating FDC for 10AC002...
   10AC002: actual mean UAR=15.24 L/s/km2
Estimating FDC for 08CA001...
   08CA001: actual mean UAR=17.39 L/s/km2
Estimating FDC for 07FB008...
   07FB008: actual mean UAR=7.82 L/s/km2
Estimating FDC for 08HB075...
   08HB075: actual mean UAR=45.44 L/s/km2
Estimating FDC for 08MA002...
   08MA002: actual mean UAR=21.71 L/s/km2
Estimating FDC for 08NG076...
   08NG076: actual mean UAR=9.78 L/s/km2
Estimating FDC for 12335100...
   12335100: actual mean UAR=7.45 L/s/km2
Estimating FDC for 08FB004...
   08FB004: actual mean UAR=55.73 L/s/km2
Estimating FDC for 12324680...
   12324680: actual mean UAR=3.26 L/s/km2
Processed 190/1093 stations in 0.00 seconds per station
Estimating FDC for 12445900...
   12445900: actual mean UAR=1.94 L/s/km2
Estimating FDC for 12202300...
   12202300: actual mean UAR=27.35 L/s/km2
Estimating FDC for 08HB048...
   08HB048: actual mean UAR=77.95 L/s/km2
Estimating FDC for 12456500...
   12456500: actual mean UAR=34.50 L/s/km2
Estimating FDC for 08MH155...
   08MH155: actual mean UAR=29.27 L/s/km2
Estimating FDC for 12041200...
   12041200: actual mean UAR=110.29 L/s/km2
Estimating FDC for 07AF002...
   07AF002: actual mean UAR=7.63 L/s/km2
Estimating FDC for 07FD004...
   07FD004: actual mean UAR=2.12 L/s/km2
Estimating FDC for 08KB003...
   08KB003: actual mean UAR=45.61 L/s/km2
Estimating FDC for 12413445...
   12413445: actual mean UAR=22.41 L/s/km2
Processed 200/1093 stations in 0.00 seconds per station
Estimating FDC for 12201950...
   12201950: actual mean UAR=58.96 L/s/km2
Estimating FDC for 07ED001...
   07ED001: actual mean UAR=14.40 L/s/km2
Estimating FDC for 08NE077...
   08NE077: actual mean UAR=19.56 L/s/km2
Estimating FDC for 08LA008...
   08LA008: actual mean UAR=7.29 L/s/km2
Estimating FDC for 12125200...
   12125200: actual mean UAR=20.99 L/s/km2
Estimating FDC for 08KA013...
   08KA013: actual mean UAR=31.69 L/s/km2
Estimating FDC for 08ME027...
   08ME027: actual mean UAR=43.02 L/s/km2
Estimating FDC for 12448500...
   12448500: actual mean UAR=13.51 L/s/km2
Estimating FDC for 12182500...
   12182500: actual mean UAR=68.71 L/s/km2
Estimating FDC for 08MD035...
   08MD035: actual mean UAR=6.98 L/s/km2
Processed 210/1093 stations in 0.00 seconds per station
Estimating FDC for 12181100...
   12181100: actual mean UAR=135.14 L/s/km2
Estimating FDC for 07GJ001...
   07GJ001: actual mean UAR=6.85 L/s/km2
Estimating FDC for 08LE031...
   08LE031: actual mean UAR=19.60 L/s/km2
Estimating FDC for 08KH010...
   08KH010: actual mean UAR=25.22 L/s/km2
Estimating FDC for 08EB004...
   08EB004: actual mean UAR=24.02 L/s/km2
Estimating FDC for 08FF006...
   08FF006: actual mean UAR=124.86 L/s/km2
Estimating FDC for 08JB012...
   08JB012: actual mean UAR=4.50 L/s/km2
Estimating FDC for 12213100...
   12213100: actual mean UAR=53.75 L/s/km2
Estimating FDC for 08FB007...
   08FB007: actual mean UAR=25.02 L/s/km2
Estimating FDC for 08NE039...
   08NE039: actual mean UAR=16.09 L/s/km2
Processed 220/1093 stations in 0.00 seconds per station
Estimating FDC for 12413370...
   12413370: actual mean UAR=18.71 L/s/km2
Estimating FDC for 12411000...
   12411000: actual mean UAR=22.37 L/s/km2
Estimating FDC for 08ND018...
   08ND018: actual mean UAR=49.48 L/s/km2
Estimating FDC for 12413860...
   12413860: actual mean UAR=19.61 L/s/km2
Estimating FDC for 08HF007...
   08HF007: actual mean UAR=64.48 L/s/km2
Estimating FDC for 10AD001...
   10AD001: actual mean UAR=14.81 L/s/km2
Estimating FDC for 08MA006...
   08MA006: actual mean UAR=7.79 L/s/km2
Estimating FDC for 10AB003...
   10AB003: actual mean UAR=8.74 L/s/km2
Estimating FDC for 15052800...
   15052800: actual mean UAR=80.33 L/s/km2
Estimating FDC for 05DA007...
   05DA007: actual mean UAR=29.07 L/s/km2
Processed 230/1093 stations in 0.00 seconds per station
Estimating FDC for 05BG006...
   05BG006: actual mean UAR=6.56 L/s/km2
Estimating FDC for 08MH029...
   08MH029: actual mean UAR=24.19 L/s/km2
Estimating FDC for 08FF003...
   08FF003: actual mean UAR=97.01 L/s/km2
Estimating FDC for 08ND019...
   08ND019: actual mean UAR=54.85 L/s/km2
Estimating FDC for 12099200...
   12099200: actual mean UAR=37.59 L/s/km2
Estimating FDC for 05BH015...
   05BH015: actual mean UAR=4.10 L/s/km2
Estimating FDC for 08KB001...
   08KB001: actual mean UAR=25.14 L/s/km2
Estimating FDC for 08NL024...
   08NL024: actual mean UAR=12.35 L/s/km2
Estimating FDC for 08LE024...
   08LE024: actual mean UAR=40.77 L/s/km2
Estimating FDC for 08KE024...
   08KE024: actual mean UAR=22.24 L/s/km2
Processed 240/1093 stations in 0.00 seconds per station
Estimating FDC for 07AG003...
   07AG003: actual mean UAR=4.93 L/s/km2
Estimating FDC for 08LF051...
   08LF051: actual mean UAR=14.05 L/s/km2
Estimating FDC for 07GA002...
   07GA002: actual mean UAR=10.10 L/s/km2
Estimating FDC for 08NH119...
   08NH119: actual mean UAR=47.58 L/s/km2
Estimating FDC for 08DA009...
   08DA009: actual mean UAR=35.74 L/s/km2
Estimating FDC for 12365700...
   12365700: actual mean UAR=6.07 L/s/km2
Estimating FDC for 08NG086...
   08NG086: actual mean UAR=20.24 L/s/km2
Estimating FDC for 08FE003...
   08FE003: actual mean UAR=83.05 L/s/km2
Estimating FDC for 12147600...
   12147600: actual mean UAR=115.16 L/s/km2
Estimating FDC for 08EE013...
   08EE013: actual mean UAR=7.91 L/s/km2
Processed 250/1093 stations in 0.00 seconds per station
Estimating FDC for 08AA008...
   08AA008: actual mean UAR=4.52 L/s/km2
Estimating FDC for 08HB014...
   08HB014: actual mean UAR=120.17 L/s/km2
Estimating FDC for 12330000...
   12330000: actual mean UAR=7.00 L/s/km2
Estimating FDC for 10ED009...
   10ED009: actual mean UAR=3.45 L/s/km2
Estimating FDC for 05BF017...
   05BF017: actual mean UAR=16.01 L/s/km2
Estimating FDC for 08HA003...
   08HA003: actual mean UAR=41.78 L/s/km2
Estimating FDC for 12157025...
   12157025: actual mean UAR=49.36 L/s/km2
Estimating FDC for 12010000...
   12010000: actual mean UAR=86.49 L/s/km2
Estimating FDC for 12416000...
   12416000: actual mean UAR=14.28 L/s/km2
Estimating FDC for 12076800...
   12076800: actual mean UAR=32.18 L/s/km2
Processed 260/1093 stations in 0.00 seconds per station
Estimating FDC for 10CD004...
   10CD004: actual mean UAR=7.51 L/s/km2
Estimating FDC for 12104500...
   12104500: actual mean UAR=42.60 L/s/km2
Estimating FDC for 12400900...
   12400900: actual mean UAR=2.36 L/s/km2
Estimating FDC for 08GA072...
   08GA072: actual mean UAR=66.05 L/s/km2
Estimating FDC for 07FB009...
   07FB009: actual mean UAR=8.83 L/s/km2
Estimating FDC for 05BJ004...
   05BJ004: actual mean UAR=11.51 L/s/km2
Estimating FDC for 08NE110...
   08NE110: actual mean UAR=13.77 L/s/km2
Estimating FDC for 08GA061...
   08GA061: actual mean UAR=68.48 L/s/km2
Estimating FDC for 08NC004...
   08NC004: actual mean UAR=48.61 L/s/km2
Estimating FDC for 08NK020...
   08NK020: actual mean UAR=17.09 L/s/km2
Processed 270/1093 stations in 0.00 seconds per station
Estimating FDC for 05DB002...
   05DB002: actual mean UAR=5.51 L/s/km2
Estimating FDC for 08LB020...
   08LB020: actual mean UAR=13.00 L/s/km2
Estimating FDC for 12207850...
   12207850: actual mean UAR=70.94 L/s/km2
Estimating FDC for 12054000...
   12054000: actual mean UAR=70.17 L/s/km2
Estimating FDC for 12392300...
   12392300: actual mean UAR=27.29 L/s/km2
Estimating FDC for 12413130...
   12413130: actual mean UAR=14.72 L/s/km2
Estimating FDC for 10AC003...
   10AC003: actual mean UAR=10.10 L/s/km2
Estimating FDC for 08MG001...
   08MG001: actual mean UAR=99.42 L/s/km2
Estimating FDC for 12186000...
   12186000: actual mean UAR=82.54 L/s/km2
Estimating FDC for 12202450...
   12202450: actual mean UAR=11.57 L/s/km2
Processed 280/1093 stations in 0.00 seconds per station
Estimating FDC for 05DB006...
   05DB006: actual mean UAR=7.82 L/s/km2
Estimating FDC for 10EB003...
   10EB003: actual mean UAR=22.29 L/s/km2
Estimating FDC for 12093500...
   12093500: actual mean UAR=47.00 L/s/km2
Estimating FDC for 12143600...
   12143600: actual mean UAR=71.25 L/s/km2
Estimating FDC for 12202310...
   12202310: actual mean UAR=17.32 L/s/km2
Estimating FDC for 08KD007...
   08KD007: actual mean UAR=20.06 L/s/km2
Estimating FDC for 07FA003...
   07FA003: actual mean UAR=9.05 L/s/km2
Estimating FDC for 12043000...
   12043000: actual mean UAR=87.69 L/s/km2
Estimating FDC for 12193400...
   12193400: actual mean UAR=98.89 L/s/km2
Estimating FDC for 12452800...
   12452800: actual mean UAR=20.25 L/s/km2
Processed 290/1093 stations in 0.00 seconds per station
Estimating FDC for 12448000...
   12448000: actual mean UAR=8.79 L/s/km2
Estimating FDC for 12413125...
   12413125: actual mean UAR=25.32 L/s/km2
Estimating FDC for 08ED002...
   08ED002: actual mean UAR=39.78 L/s/km2
Estimating FDC for 10ED003...
   10ED003: actual mean UAR=5.06 L/s/km2
Estimating FDC for 12303500...
   12303500: actual mean UAR=22.46 L/s/km2
Estimating FDC for 12036400...
   12036400: actual mean UAR=68.41 L/s/km2
Estimating FDC for 12092000...
   12092000: actual mean UAR=63.45 L/s/km2
Estimating FDC for 08MA003...
   08MA003: actual mean UAR=24.74 L/s/km2
Estimating FDC for 05AA008...
   05AA008: actual mean UAR=12.65 L/s/km2
Estimating FDC for 08FC005...
   08FC005: actual mean UAR=0.99 L/s/km2
Processed 300/1093 stations in 0.00 seconds per station
Estimating FDC for 08KH006...
   08KH006: actual mean UAR=21.07 L/s/km2
Estimating FDC for 15039900...
   15039900: actual mean UAR=118.32 L/s/km2
Estimating FDC for 12097850...
   12097850: actual mean UAR=40.79 L/s/km2
Estimating FDC for 10AC006...
   10AC006: actual mean UAR=12.35 L/s/km2
Estimating FDC for 08KG001...
   08KG001: actual mean UAR=3.32 L/s/km2
Estimating FDC for 08CG004...
   08CG004: actual mean UAR=39.49 L/s/km2
Estimating FDC for 08GA065...
   08GA065: actual mean UAR=98.49 L/s/km2
Estimating FDC for 12458000...
   12458000: actual mean UAR=35.67 L/s/km2
Estimating FDC for 12108500...
   12108500: actual mean UAR=23.21 L/s/km2
Estimating FDC for 08CE001...
   08CE001: actual mean UAR=14.62 L/s/km2
Processed 310/1093 stations in 0.00 seconds per station
Estimating FDC for 10AA001...
   10AA001: actual mean UAR=11.60 L/s/km2
Estimating FDC for 08KH003...
   08KH003: actual mean UAR=29.31 L/s/km2
Estimating FDC for 15081580...
   15081580: actual mean UAR=169.29 L/s/km2
Estimating FDC for 07FC001...
   07FC001: actual mean UAR=3.49 L/s/km2
Estimating FDC for 08EG012...
   08EG012: actual mean UAR=117.99 L/s/km2
Estimating FDC for 08NM174...
   08NM174: actual mean UAR=5.76 L/s/km2
Estimating FDC for 12366080...
   12366080: actual mean UAR=14.51 L/s/km2
Estimating FDC for 12331500...
   12331500: actual mean UAR=3.10 L/s/km2
Estimating FDC for 10AD002...
   10AD002: actual mean UAR=20.17 L/s/km2
Estimating FDC for 08MF065...
   08MF065: actual mean UAR=51.25 L/s/km2
Processed 320/1093 stations in 0.00 seconds per station
Estimating FDC for 12207750...
   12207750: actual mean UAR=72.80 L/s/km2
Estimating FDC for 05BL012...
   05BL012: actual mean UAR=5.22 L/s/km2
Estimating FDC for 08LG068...
   08LG068: actual mean UAR=19.60 L/s/km2
Estimating FDC for 12137800...
   12137800: actual mean UAR=26.88 L/s/km2
Estimating FDC for 12390700...
   12390700: actual mean UAR=13.92 L/s/km2
Estimating FDC for 08NE087...
   08NE087: actual mean UAR=11.24 L/s/km2
Estimating FDC for 10ED001...
   10ED001: actual mean UAR=9.18 L/s/km2
Estimating FDC for 12100496...
   12100496: actual mean UAR=21.03 L/s/km2
Estimating FDC for 12122500...
   12122500: actual mean UAR=17.11 L/s/km2
Estimating FDC for 08KD001...
   08KD001: actual mean UAR=21.01 L/s/km2
Processed 330/1093 stations in 0.00 seconds per station
Estimating FDC for 08CD001...
   08CD001: actual mean UAR=10.50 L/s/km2
Estimating FDC for 08HA070...
   08HA070: actual mean UAR=101.83 L/s/km2
Estimating FDC for 12080010...
   12080010: actual mean UAR=27.39 L/s/km2
Estimating FDC for 12088000...
   12088000: actual mean UAR=21.46 L/s/km2
Estimating FDC for 08NM242...
   08NM242: actual mean UAR=13.85 L/s/km2
Estimating FDC for 10AA002...
   10AA002: actual mean UAR=6.71 L/s/km2
Estimating FDC for 08EE005...
   08EE005: actual mean UAR=19.42 L/s/km2
Estimating FDC for 12205000...
   12205000: actual mean UAR=84.36 L/s/km2
Estimating FDC for 07GF001...
   07GF001: actual mean UAR=6.05 L/s/km2
Estimating FDC for 15056095...
   15056095: actual mean UAR=47.11 L/s/km2
Processed 340/1093 stations in 0.00 seconds per station
Estimating FDC for 15081995...
   15081995: actual mean UAR=147.76 L/s/km2
Estimating FDC for 08ME025...
   08ME025: actual mean UAR=7.67 L/s/km2
Estimating FDC for 12027500...
   12027500: actual mean UAR=35.31 L/s/km2
Estimating FDC for 09AA012...
   09AA012: actual mean UAR=9.25 L/s/km2
Estimating FDC for 08AC001...
   08AC001: actual mean UAR=11.31 L/s/km2
Estimating FDC for 08CC003...
   08CC003: actual mean UAR=36.66 L/s/km2
Estimating FDC for 10BE013...
   10BE013: actual mean UAR=6.79 L/s/km2
Estimating FDC for 12120600...
   12120600: actual mean UAR=30.59 L/s/km2
Estimating FDC for 12209000...
   12209000: actual mean UAR=76.60 L/s/km2
Estimating FDC for 05BA001...
   05BA001: actual mean UAR=31.56 L/s/km2
Processed 350/1093 stations in 0.00 seconds per station
Estimating FDC for 08LG016...
   08LG016: actual mean UAR=8.57 L/s/km2
Estimating FDC for 12149000...
   12149000: actual mean UAR=67.68 L/s/km2
Estimating FDC for 08LE094...
   08LE094: actual mean UAR=4.95 L/s/km2
Estimating FDC for 12452500...
   12452500: actual mean UAR=24.95 L/s/km2
Estimating FDC for 05BB001...
   05BB001: actual mean UAR=17.54 L/s/km2
Estimating FDC for 10CD006...
   10CD006: actual mean UAR=9.86 L/s/km2
Estimating FDC for 05BL022...
   05BL022: actual mean UAR=11.84 L/s/km2
Estimating FDC for 08NG046...
   08NG046: actual mean UAR=27.30 L/s/km2
Estimating FDC for 12334550...
   12334550: actual mean UAR=3.95 L/s/km2
Estimating FDC for 12144000...
   12144000: actual mean UAR=73.74 L/s/km2
Processed 360/1093 stations in 0.00 seconds per station
Estimating FDC for 08NB005...
   08NB005: actual mean UAR=17.79 L/s/km2
Estimating FDC for 08HF006...
   08HF006: actual mean UAR=114.73 L/s/km2
Estimating FDC for 08NN028...
   08NN028: actual mean UAR=7.16 L/s/km2
Estimating FDC for 08NP004...
   08NP004: actual mean UAR=21.24 L/s/km2
Estimating FDC for 08NB016...
   08NB016: actual mean UAR=20.48 L/s/km2
Estimating FDC for 12127100...
   12127100: actual mean UAR=16.70 L/s/km2
Estimating FDC for 12083000...
   12083000: actual mean UAR=55.45 L/s/km2
Estimating FDC for 07FB006...
   07FB006: actual mean UAR=24.72 L/s/km2
Estimating FDC for 10BC001...
   10BC001: actual mean UAR=10.57 L/s/km2
Estimating FDC for 12039300...
   12039300: actual mean UAR=127.90 L/s/km2
Processed 370/1093 stations in 0.00 seconds per station
Estimating FDC for 08EF001...
   08EF001: actual mean UAR=21.82 L/s/km2
Estimating FDC for 08NK016...
   08NK016: actual mean UAR=14.09 L/s/km2
Estimating FDC for 12098500...
   12098500: actual mean UAR=39.99 L/s/km2
Estimating FDC for 08NL038...
   08NL038: actual mean UAR=8.79 L/s/km2
Estimating FDC for 08ED001...
   08ED001: actual mean UAR=39.62 L/s/km2
Estimating FDC for 12147500...
   12147500: actual mean UAR=97.92 L/s/km2
Estimating FDC for 08NE021...
   08NE021: actual mean UAR=23.55 L/s/km2
Estimating FDC for 10AC005...
   10AC005: actual mean UAR=20.97 L/s/km2
Estimating FDC for 12413000...
   12413000: actual mean UAR=22.93 L/s/km2
Estimating FDC for 08MH103...
   08MH103: actual mean UAR=54.61 L/s/km2
Processed 380/1093 stations in 0.00 seconds per station
Estimating FDC for 05BL014...
   05BL014: actual mean UAR=8.46 L/s/km2
Estimating FDC for 07FB003...
   07FB003: actual mean UAR=21.82 L/s/km2
Estimating FDC for 08JD006...
   08JD006: actual mean UAR=20.48 L/s/km2
Estimating FDC for 12105710...
   12105710: actual mean UAR=54.84 L/s/km2
Estimating FDC for 12096500...
   12096500: actual mean UAR=42.56 L/s/km2
Estimating FDC for 12370000...
   12370000: actual mean UAR=19.28 L/s/km2
Estimating FDC for 08HA010...
   08HA010: actual mean UAR=82.39 L/s/km2
Estimating FDC for 08NH132...
   08NH132: actual mean UAR=35.85 L/s/km2
Estimating FDC for 08DC006...
   08DC006: actual mean UAR=72.46 L/s/km2
Estimating FDC for 15106920...
   15106920: actual mean UAR=68.43 L/s/km2
Processed 390/1093 stations in 0.00 seconds per station
Estimating FDC for 12113347...
   12113347: actual mean UAR=18.19 L/s/km2
Estimating FDC for 08LG066...
   08LG066: actual mean UAR=1.85 L/s/km2
Estimating FDC for 09AC001...
   09AC001: actual mean UAR=8.96 L/s/km2
Estimating FDC for 08NN012...
   08NN012: actual mean UAR=8.66 L/s/km2
Estimating FDC for 12179900...
   12179900: actual mean UAR=99.73 L/s/km2
Estimating FDC for 12056500...
   12056500: actual mean UAR=102.72 L/s/km2
Estimating FDC for 08HA069...
   08HA069: actual mean UAR=190.35 L/s/km2
Estimating FDC for 12448998...
   12448998: actual mean UAR=12.07 L/s/km2
Estimating FDC for 08GB013...
   08GB013: actual mean UAR=104.09 L/s/km2
Estimating FDC for 08NJ061...
   08NJ061: actual mean UAR=31.56 L/s/km2
Processed 400/1093 stations in 0.00 seconds per station
Estimating FDC for 08GD008...
   08GD008: actual mean UAR=3.84 L/s/km2
Estimating FDC for 10BE011...
   10BE011: actual mean UAR=9.14 L/s/km2
Estimating FDC for 08GA077...
   08GA077: actual mean UAR=102.47 L/s/km2
Estimating FDC for 08EB003...
   08EB003: actual mean UAR=22.59 L/s/km2
Estimating FDC for 12020000...
   12020000: actual mean UAR=56.51 L/s/km2
Estimating FDC for 10AB001...
   10AB001: actual mean UAR=12.75 L/s/km2
Estimating FDC for 08BB001...
   08BB001: actual mean UAR=18.85 L/s/km2
Estimating FDC for 08NJ019...
   08NJ019: actual mean UAR=36.43 L/s/km2
Estimating FDC for 07FA006...
   07FA006: actual mean UAR=7.53 L/s/km2
Estimating FDC for 08NJ168...
   08NJ168: actual mean UAR=25.94 L/s/km2
Processed 410/1093 stations in 0.00 seconds per station
Estimating FDC for 08MB007...
   08MB007: actual mean UAR=14.00 L/s/km2
Estimating FDC for 12304040...
   12304040: actual mean UAR=13.29 L/s/km2
Estimating FDC for 12202400...
   12202400: actual mean UAR=11.60 L/s/km2
Estimating FDC for 12335500...
   12335500: actual mean UAR=3.34 L/s/km2
Estimating FDC for 12025700...
   12025700: actual mean UAR=55.34 L/s/km2
Estimating FDC for 08HE010...
   08HE010: actual mean UAR=149.13 L/s/km2
Estimating FDC for 10EA002...
   10EA002: actual mean UAR=15.63 L/s/km2
Estimating FDC for 08LD001...
   08LD001: actual mean UAR=22.49 L/s/km2
Estimating FDC for 08KD006...
   08KD006: actual mean UAR=12.70 L/s/km2
Estimating FDC for 10FB005...
   10FB005: actual mean UAR=4.28 L/s/km2
Processed 420/1093 stations in 0.00 seconds per station
Estimating FDC for 10DA001...
   10DA001: actual mean UAR=2.56 L/s/km2
Estimating FDC for 12392155...
   12392155: actual mean UAR=39.29 L/s/km2
Estimating FDC for 12137290...
   12137290: actual mean UAR=124.76 L/s/km2
Estimating FDC for 08EE004...
   08EE004: actual mean UAR=18.36 L/s/km2
Estimating FDC for 08HA026...
   08HA026: actual mean UAR=9.77 L/s/km2
Estimating FDC for 07HA005...
   07HA005: actual mean UAR=2.52 L/s/km2
Estimating FDC for 12301300...
   12301300: actual mean UAR=6.88 L/s/km2
Estimating FDC for 12408500...
   12408500: actual mean UAR=6.39 L/s/km2
Estimating FDC for 08DA010...
   08DA010: actual mean UAR=55.96 L/s/km2
Estimating FDC for 08HD023...
   08HD023: actual mean UAR=19.12 L/s/km2
Processed 430/1093 stations in 0.00 seconds per station
Estimating FDC for 12210000...
   12210000: actual mean UAR=79.46 L/s/km2
Estimating FDC for 08NJ026...
   08NJ026: actual mean UAR=28.56 L/s/km2
Estimating FDC for 09AE001...
   09AE001: actual mean UAR=9.94 L/s/km2
Estimating FDC for 08NM137...
   08NM137: actual mean UAR=3.68 L/s/km2
Estimating FDC for 07FB002...
   07FB002: actual mean UAR=15.16 L/s/km2
Estimating FDC for 08KA004...
   08KA004: actual mean UAR=25.89 L/s/km2
Estimating FDC for 08MC045...
   08MC045: actual mean UAR=2.53 L/s/km2
Estimating FDC for 08AB002...
   08AB002: actual mean UAR=31.54 L/s/km2
Estimating FDC for 15087700...
   15087700: actual mean UAR=92.84 L/s/km2
Estimating FDC for 08KB006...
   08KB006: actual mean UAR=46.73 L/s/km2
Processed 440/1093 stations in 0.00 seconds per station
Estimating FDC for 08LB064...
   08LB064: actual mean UAR=22.00 L/s/km2
Estimating FDC for 09AE006...
   09AE006: actual mean UAR=11.75 L/s/km2
Estimating FDC for 10CD003...
   10CD003: actual mean UAR=4.46 L/s/km2
Estimating FDC for 08CB001...
   08CB001: actual mean UAR=16.41 L/s/km2
Estimating FDC for 08ND013...
   08ND013: actual mean UAR=46.09 L/s/km2
Estimating FDC for 15129600...
   15129600: actual mean UAR=70.07 L/s/km2
Estimating FDC for 08LF100...
   08LF100: actual mean UAR=1.66 L/s/km2
Estimating FDC for 12452890...
   12452890: actual mean UAR=11.41 L/s/km2
Estimating FDC for 12409000...
   12409000: actual mean UAR=3.53 L/s/km2
Estimating FDC for 08LF081...
   08LF081: actual mean UAR=0.66 L/s/km2
Processed 450/1093 stations in 0.00 seconds per station
Estimating FDC for 15083500...
   15083500: actual mean UAR=121.12 L/s/km2
Estimating FDC for 15050000...
   15050000: actual mean UAR=122.67 L/s/km2
Estimating FDC for 08NP002...
   08NP002: actual mean UAR=20.62 L/s/km2
Estimating FDC for 05DC012...
   05DC012: actual mean UAR=4.88 L/s/km2
Estimating FDC for 10BE001...
   10BE001: actual mean UAR=11.01 L/s/km2
Estimating FDC for 07GE001...
   07GE001: actual mean UAR=8.63 L/s/km2
Estimating FDC for 12190718...
   12190718: actual mean UAR=126.74 L/s/km2
Estimating FDC for 07FC003...
   07FC003: actual mean UAR=3.00 L/s/km2
Estimating FDC for 08CA003...
   08CA003: actual mean UAR=16.56 L/s/km2
Estimating FDC for 08KH001...
   08KH001: actual mean UAR=22.41 L/s/km2
Processed 460/1093 stations in 0.00 seconds per station
Estimating FDC for 05CA009...
   05CA009: actual mean UAR=9.53 L/s/km2
Estimating FDC for 05CB001...
   05CB001: actual mean UAR=1.83 L/s/km2
Estimating FDC for 08NK026...
   08NK026: actual mean UAR=17.86 L/s/km2
Estimating FDC for 08NH005...
   08NH005: actual mean UAR=29.73 L/s/km2
Estimating FDC for 08EC013...
   08EC013: actual mean UAR=7.63 L/s/km2
Estimating FDC for 12365000...
   12365000: actual mean UAR=6.99 L/s/km2
Estimating FDC for 08GD004...
   08GD004: actual mean UAR=49.22 L/s/km2
Estimating FDC for 12121600...
   12121600: actual mean UAR=25.50 L/s/km2
Estimating FDC for 12375900...
   12375900: actual mean UAR=30.14 L/s/km2
Estimating FDC for 12094000...
   12094000: actual mean UAR=60.72 L/s/km2
Processed 470/1093 stations in 0.00 seconds per station
Estimating FDC for 12447390...
   12447390: actual mean UAR=16.27 L/s/km2
Estimating FDC for 08EF005...
   08EF005: actual mean UAR=37.07 L/s/km2
Estimating FDC for 08NJ130...
   08NJ130: actual mean UAR=13.37 L/s/km2
Estimating FDC for 08DB013...
   08DB013: actual mean UAR=38.16 L/s/km2
Estimating FDC for 08JE004...
   08JE004: actual mean UAR=6.02 L/s/km2
Estimating FDC for 08JE005...
   08JE005: actual mean UAR=6.85 L/s/km2
Estimating FDC for 08MF068...
   08MF068: actual mean UAR=42.66 L/s/km2
Estimating FDC for 08LB076...
   08LB076: actual mean UAR=24.21 L/s/km2
Estimating FDC for 08HB089...
   08HB089: actual mean UAR=46.87 L/s/km2
Estimating FDC for 12115500...
   12115500: actual mean UAR=81.51 L/s/km2
Processed 480/1093 stations in 0.00 seconds per station
Estimating FDC for 08HB032...
   08HB032: actual mean UAR=26.22 L/s/km2
Estimating FDC for 07BB003...
   07BB003: actual mean UAR=2.86 L/s/km2
Estimating FDC for 08FC003...
   08FC003: actual mean UAR=4.95 L/s/km2
Estimating FDC for 08NL070...
   08NL070: actual mean UAR=19.55 L/s/km2
Estimating FDC for 12424000...
   12424000: actual mean UAR=3.68 L/s/km2
Estimating FDC for 08NB012...
   08NB012: actual mean UAR=28.57 L/s/km2
Estimating FDC for 10CA001...
   10CA001: actual mean UAR=4.07 L/s/km2
Estimating FDC for 08NL069...
   08NL069: actual mean UAR=14.62 L/s/km2
Estimating FDC for 09AE003...
   09AE003: actual mean UAR=14.00 L/s/km2
Estimating FDC for 12354500...
   12354500: actual mean UAR=7.50 L/s/km2
Processed 490/1093 stations in 0.00 seconds per station
Estimating FDC for 08NL036...
   08NL036: actual mean UAR=5.61 L/s/km2
Estimating FDC for 10BD001...
   10BD001: actual mean UAR=8.73 L/s/km2
Estimating FDC for 08KC001...
   08KC001: actual mean UAR=6.95 L/s/km2
Estimating FDC for 12141300...
   12141300: actual mean UAR=88.13 L/s/km2
Estimating FDC for 08NA002...
   08NA002: actual mean UAR=16.36 L/s/km2
Estimating FDC for 12117000...
   12117000: actual mean UAR=61.41 L/s/km2
Estimating FDC for 08EE025...
   08EE025: actual mean UAR=5.95 L/s/km2
Estimating FDC for 10BE004...
   10BE004: actual mean UAR=16.93 L/s/km2
Estimating FDC for 12200500...
   12200500: actual mean UAR=59.53 L/s/km2
Estimating FDC for 08MH104...
   08MH104: actual mean UAR=25.09 L/s/km2
Processed 500/1093 stations in 0.00 seconds per station
Estimating FDC for 07EC003...
   07EC003: actual mean UAR=14.49 L/s/km2
Estimating FDC for 07UC001...
   07UC001: actual mean UAR=3.06 L/s/km2
Estimating FDC for 12190710...
   12190710: actual mean UAR=124.93 L/s/km2
Estimating FDC for 05CB004...
   05CB004: actual mean UAR=3.49 L/s/km2
Estimating FDC for 12388200...
   12388200: actual mean UAR=6.76 L/s/km2
Estimating FDC for 12377150...
   12377150: actual mean UAR=44.86 L/s/km2
Estimating FDC for 15087690...
   15087690: actual mean UAR=109.03 L/s/km2
Estimating FDC for 12115800...
   12115800: actual mean UAR=51.04 L/s/km2
Estimating FDC for 08ME023...
   08ME023: actual mean UAR=89.91 L/s/km2
Estimating FDC for 12102075...
   12102075: actual mean UAR=49.70 L/s/km2
Processed 510/1093 stations in 0.00 seconds per station
Estimating FDC for 07EE009...
   07EE009: actual mean UAR=16.76 L/s/km2
Estimating FDC for 12155300...
   12155300: actual mean UAR=42.66 L/s/km2
Estimating FDC for 07BB002...
   07BB002: actual mean UAR=4.75 L/s/km2
Estimating FDC for 07AD002...
   07AD002: actual mean UAR=18.05 L/s/km2
Estimating FDC for 08GE003...
   08GE003: actual mean UAR=122.48 L/s/km2
Estimating FDC for 12331900...
   12331900: actual mean UAR=3.18 L/s/km2
Estimating FDC for 12339450...
   12339450: actual mean UAR=8.87 L/s/km2
Estimating FDC for 08DB001...
   08DB001: actual mean UAR=42.26 L/s/km2
Estimating FDC for 08NK018...
   08NK018: actual mean UAR=12.83 L/s/km2
Estimating FDC for 12323720...
   12323720: actual mean UAR=4.22 L/s/km2
Processed 520/1093 stations in 0.00 seconds per station
Estimating FDC for 08FB006...
   08FB006: actual mean UAR=11.71 L/s/km2
Estimating FDC for 09AB008...
   09AB008: actual mean UAR=5.75 L/s/km2
Estimating FDC for 08CG005...
   08CG005: actual mean UAR=56.42 L/s/km2
Estimating FDC for 08LB038...
   08LB038: actual mean UAR=40.57 L/s/km2
Estimating FDC for 12143400...
   12143400: actual mean UAR=78.15 L/s/km2
Estimating FDC for 12323850...
   12323850: actual mean UAR=6.14 L/s/km2
Estimating FDC for 08NF001...
   08NF001: actual mean UAR=11.73 L/s/km2
Estimating FDC for 08KA008...
   08KA008: actual mean UAR=31.89 L/s/km2
Estimating FDC for 05BF016...
   05BF016: actual mean UAR=16.88 L/s/km2
Estimating FDC for 08GD006...
   08GD006: actual mean UAR=36.26 L/s/km2
Processed 530/1093 stations in 0.00 seconds per station
Estimating FDC for 07GD003...
   07GD003: actual mean UAR=2.88 L/s/km2
Estimating FDC for 10BE007...
   10BE007: actual mean UAR=13.81 L/s/km2
Estimating FDC for 08AA009...
   08AA009: actual mean UAR=3.36 L/s/km2
Estimating FDC for 12413360...
   12413360: actual mean UAR=28.11 L/s/km2
Estimating FDC for 07EB002...
   07EB002: actual mean UAR=18.00 L/s/km2
Estimating FDC for 08DB014...
   08DB014: actual mean UAR=32.34 L/s/km2
Estimating FDC for 08MH141...
   08MH141: actual mean UAR=127.30 L/s/km2
Estimating FDC for 08NH115...
   08NH115: actual mean UAR=10.34 L/s/km2
Estimating FDC for 08NN022...
   08NN022: actual mean UAR=8.38 L/s/km2
Estimating FDC for 12366000...
   12366000: actual mean UAR=12.59 L/s/km2
Processed 540/1093 stations in 0.00 seconds per station
Estimating FDC for 12344000...
   12344000: actual mean UAR=9.26 L/s/km2
Estimating FDC for 08NL004...
   08NL004: actual mean UAR=7.44 L/s/km2
Estimating FDC for 12175500...
   12175500: actual mean UAR=65.74 L/s/km2
Estimating FDC for 07GG001...
   07GG001: actual mean UAR=4.68 L/s/km2
Estimating FDC for 12158040...
   12158040: actual mean UAR=10.53 L/s/km2
Estimating FDC for 09AE004...
   09AE004: actual mean UAR=7.59 L/s/km2
Estimating FDC for 07GD004...
   07GD004: actual mean UAR=4.59 L/s/km2
Estimating FDC for 07AA001...
   07AA001: actual mean UAR=16.90 L/s/km2
Estimating FDC for 08KE016...
   08KE016: actual mean UAR=3.45 L/s/km2
Estimating FDC for 08HD015...
   08HD015: actual mean UAR=50.78 L/s/km2
Processed 550/1093 stations in 0.00 seconds per station
Estimating FDC for 08GA075...
   08GA075: actual mean UAR=84.74 L/s/km2
Estimating FDC for 12167000...
   12167000: actual mean UAR=81.48 L/s/km2
Estimating FDC for 08NG012...
   08NG012: actual mean UAR=22.10 L/s/km2
Estimating FDC for 07OC001...
   07OC001: actual mean UAR=2.75 L/s/km2
Estimating FDC for 15041200...
   15041200: actual mean UAR=22.92 L/s/km2
Estimating FDC for 08EE020...
   08EE020: actual mean UAR=39.06 L/s/km2
Estimating FDC for 08NH051...
   08NH051: actual mean UAR=12.43 L/s/km2
Estimating FDC for 08LB069...
   08LB069: actual mean UAR=18.88 L/s/km2
Estimating FDC for 08EE003...
   08EE003: actual mean UAR=7.55 L/s/km2
Estimating FDC for 12060500...
   12060500: actual mean UAR=106.64 L/s/km2
Processed 560/1093 stations in 0.00 seconds per station
Estimating FDC for 12048000...
   12048000: actual mean UAR=27.69 L/s/km2
Estimating FDC for 08HF004...
   08HF004: actual mean UAR=61.47 L/s/km2
Estimating FDC for 12457000...
   12457000: actual mean UAR=42.65 L/s/km2
Estimating FDC for 12043163...
   12043163: actual mean UAR=69.62 L/s/km2
Estimating FDC for 15099900...
   15099900: actual mean UAR=164.88 L/s/km2
Estimating FDC for 08NB014...
   08NB014: actual mean UAR=42.49 L/s/km2
Estimating FDC for 08LC040...
   08LC040: actual mean UAR=7.26 L/s/km2
Estimating FDC for 08EE012...
   08EE012: actual mean UAR=19.08 L/s/km2
Estimating FDC for 08NG078...
   08NG078: actual mean UAR=6.89 L/s/km2
Estimating FDC for 08NG077...
   08NG077: actual mean UAR=34.24 L/s/km2
Processed 570/1093 stations in 0.00 seconds per station
Estimating FDC for 08EC001...
   08EC001: actual mean UAR=7.50 L/s/km2
Estimating FDC for 08NM241...
   08NM241: actual mean UAR=12.96 L/s/km2
Estimating FDC for 08LG056...
   08LG056: actual mean UAR=2.30 L/s/km2
Estimating FDC for 12358500...
   12358500: actual mean UAR=28.41 L/s/km2
Estimating FDC for 07FA005...
   07FA005: actual mean UAR=11.06 L/s/km2
Estimating FDC for 08GF007...
   08GF007: actual mean UAR=110.32 L/s/km2
Estimating FDC for 08JA014...
   08JA014: actual mean UAR=6.00 L/s/km2
Estimating FDC for 12026150...
   12026150: actual mean UAR=43.83 L/s/km2
Estimating FDC for 08NJ129...
   08NJ129: actual mean UAR=14.16 L/s/km2
Estimating FDC for 12449500...
   12449500: actual mean UAR=12.75 L/s/km2
Processed 580/1093 stations in 0.00 seconds per station
Estimating FDC for 12396900...
   12396900: actual mean UAR=19.37 L/s/km2
Estimating FDC for 08NH084...
   08NH084: actual mean UAR=21.75 L/s/km2
Estimating FDC for 10BE012...
   10BE012: actual mean UAR=10.10 L/s/km2
Estimating FDC for 10BB002...
   10BB002: actual mean UAR=12.60 L/s/km2
Estimating FDC for 08MH016...
   08MH016: actual mean UAR=59.40 L/s/km2
Estimating FDC for 07EA005...
   07EA005: actual mean UAR=16.40 L/s/km2
Estimating FDC for 08GD005...
   08GD005: actual mean UAR=24.96 L/s/km2
Estimating FDC for 05DD009...
   05DD009: actual mean UAR=5.83 L/s/km2
Estimating FDC for 12392895...
   12392895: actual mean UAR=17.17 L/s/km2
Estimating FDC for 08MH076...
   08MH076: actual mean UAR=59.87 L/s/km2
Processed 590/1093 stations in 0.00 seconds per station
Estimating FDC for 12449950...
   12449950: actual mean UAR=9.79 L/s/km2
Estimating FDC for 08DB010...
   08DB010: actual mean UAR=45.14 L/s/km2
Estimating FDC for 08NF002...
   08NF002: actual mean UAR=16.38 L/s/km2
Estimating FDC for 08MB006...
   08MB006: actual mean UAR=6.01 L/s/km2
Estimating FDC for 08MF062...
   08MF062: actual mean UAR=38.89 L/s/km2
Estimating FDC for 08NN013...
   08NN013: actual mean UAR=8.08 L/s/km2
Estimating FDC for 15106980...
   15106980: actual mean UAR=73.96 L/s/km2
Estimating FDC for 12035002...
   12035002: actual mean UAR=37.56 L/s/km2
Estimating FDC for 10BA001...
   10BA001: actual mean UAR=13.30 L/s/km2
Estimating FDC for 12040500...
   12040500: actual mean UAR=109.86 L/s/km2
Processed 600/1093 stations in 0.00 seconds per station
Estimating FDC for 07FD001...
   07FD001: actual mean UAR=3.01 L/s/km2
Estimating FDC for 12434590...
   12434590: actual mean UAR=3.42 L/s/km2
Estimating FDC for 10CD001...
   10CD001: actual mean UAR=10.77 L/s/km2
Estimating FDC for 07GA001...
   07GA001: actual mean UAR=25.16 L/s/km2
Estimating FDC for 12100000...
   12100000: actual mean UAR=14.30 L/s/km2
Estimating FDC for 08MA001...
   08MA001: actual mean UAR=13.13 L/s/km2
Estimating FDC for 07EF004...
   07EF004: actual mean UAR=17.71 L/s/km2
Estimating FDC for 12323770...
   12323770: actual mean UAR=4.18 L/s/km2
Estimating FDC for 08MG013...
   08MG013: actual mean UAR=56.57 L/s/km2
Estimating FDC for 08KE009...
   08KE009: actual mean UAR=13.52 L/s/km2
Processed 610/1093 stations in 0.00 seconds per station
Estimating FDC for 08KA001...
   08KA001: actual mean UAR=35.62 L/s/km2
Estimating FDC for 08MG026...
   08MG026: actual mean UAR=44.64 L/s/km2
Estimating FDC for 08GC008...
   08GC008: actual mean UAR=48.32 L/s/km2
Estimating FDC for 08NM240...
   08NM240: actual mean UAR=12.56 L/s/km2
Estimating FDC for 08NH138...
   08NH138: actual mean UAR=41.17 L/s/km2
Estimating FDC for 08LA027...
   08LA027: actual mean UAR=3.65 L/s/km2
Estimating FDC for 15081495...
   15081495: actual mean UAR=67.17 L/s/km2
Estimating FDC for 12334510...
   12334510: actual mean UAR=6.61 L/s/km2
Estimating FDC for 12158032...
   12158032: actual mean UAR=19.32 L/s/km2
Estimating FDC for 15081614...
   15081614: actual mean UAR=87.71 L/s/km2
Processed 620/1093 stations in 0.00 seconds per station
Estimating FDC for 12145500...
   12145500: actual mean UAR=47.49 L/s/km2
Estimating FDC for 08NJ162...
   08NJ162: actual mean UAR=8.30 L/s/km2
Estimating FDC for 08CG001...
   08CG001: actual mean UAR=49.12 L/s/km2
Estimating FDC for 08HA068...
   08HA068: actual mean UAR=68.27 L/s/km2
Estimating FDC for 08CC002...
   08CC002: actual mean UAR=49.13 L/s/km2
Estimating FDC for 08NK002...
   08NK002: actual mean UAR=15.27 L/s/km2
Estimating FDC for 12073500...
   12073500: actual mean UAR=19.08 L/s/km2
Estimating FDC for 08NE008...
   08NE008: actual mean UAR=28.48 L/s/km2
Estimating FDC for 12201500...
   12201500: actual mean UAR=30.79 L/s/km2
Estimating FDC for 08LG048...
   08LG048: actual mean UAR=21.57 L/s/km2
Processed 630/1093 stations in 0.00 seconds per station
Estimating FDC for 08LE075...
   08LE075: actual mean UAR=5.23 L/s/km2
Estimating FDC for 07FB004...
   07FB004: actual mean UAR=7.52 L/s/km2
Estimating FDC for 08FF001...
   08FF001: actual mean UAR=65.98 L/s/km2
Estimating FDC for 12185300...
   12185300: actual mean UAR=117.19 L/s/km2
Estimating FDC for 09AB009...
   09AB009: actual mean UAR=10.71 L/s/km2
Estimating FDC for 07FB005...
   07FB005: actual mean UAR=6.43 L/s/km2
Estimating FDC for 12037400...
   12037400: actual mean UAR=90.91 L/s/km2
Estimating FDC for 15024750...
   15024750: actual mean UAR=120.94 L/s/km2
Estimating FDC for 12369200...
   12369200: actual mean UAR=25.23 L/s/km2
Estimating FDC for 08NN019...
   08NN019: actual mean UAR=9.70 L/s/km2
Processed 640/1093 stations in 0.00 seconds per station
Estimating FDC for 12354000...
   12354000: actual mean UAR=18.56 L/s/km2
Estimating FDC for 12113346...
   12113346: actual mean UAR=13.19 L/s/km2
Estimating FDC for 08KH029...
   08KH029: actual mean UAR=17.83 L/s/km2
Estimating FDC for 12043300...
   12043300: actual mean UAR=76.79 L/s/km2
Estimating FDC for 12210700...
   12210700: actual mean UAR=66.85 L/s/km2
Estimating FDC for 10BE005...
   10BE005: actual mean UAR=11.79 L/s/km2
Estimating FDC for 08KC003...
   08KC003: actual mean UAR=6.70 L/s/km2
Estimating FDC for 12413875...
   12413875: actual mean UAR=29.22 L/s/km2
Estimating FDC for 12157250...
   12157250: actual mean UAR=9.26 L/s/km2
Estimating FDC for 12036650...
   12036650: actual mean UAR=57.77 L/s/km2
Processed 650/1093 stations in 0.00 seconds per station
Estimating FDC for 12351200...
   12351200: actual mean UAR=9.79 L/s/km2
Estimating FDC for 08CF003...
   08CF003: actual mean UAR=30.87 L/s/km2
Estimating FDC for 08HF008...
   08HF008: actual mean UAR=87.00 L/s/km2
Estimating FDC for 08NN023...
   08NN023: actual mean UAR=19.74 L/s/km2
Estimating FDC for 12452990...
   12452990: actual mean UAR=12.97 L/s/km2
Estimating FDC for 08JB002...
   08JB002: actual mean UAR=5.23 L/s/km2
Estimating FDC for 08NA012...
   08NA012: actual mean UAR=20.62 L/s/km2
Estimating FDC for 08NG051...
   08NG051: actual mean UAR=16.40 L/s/km2
Estimating FDC for 09AA010...
   09AA010: actual mean UAR=42.75 L/s/km2
Estimating FDC for 12192700...
   12192700: actual mean UAR=64.56 L/s/km2
Processed 660/1093 stations in 0.00 seconds per station
Estimating FDC for 12026400...
   12026400: actual mean UAR=34.62 L/s/km2
Estimating FDC for 10ED002...
   10ED002: actual mean UAR=9.23 L/s/km2
Estimating FDC for 12323670...
   12323670: actual mean UAR=9.83 L/s/km2
Estimating FDC for 15101490...
   15101490: actual mean UAR=55.34 L/s/km2
Estimating FDC for 08KA007...
   08KA007: actual mean UAR=26.59 L/s/km2
Estimating FDC for 05CC007...
   05CC007: actual mean UAR=2.35 L/s/km2
Estimating FDC for 15049900...
   15049900: actual mean UAR=137.31 L/s/km2
Estimating FDC for 08KH022...
   08KH022: actual mean UAR=31.94 L/s/km2
Estimating FDC for 08HE009...
   08HE009: actual mean UAR=199.24 L/s/km2
Estimating FDC for 08HD011...
   08HD011: actual mean UAR=45.29 L/s/km2
Processed 670/1093 stations in 0.00 seconds per station
Estimating FDC for 08GF006...
   08GF006: actual mean UAR=100.34 L/s/km2
Estimating FDC for 08KG003...
   08KG003: actual mean UAR=2.37 L/s/km2
Estimating FDC for 08NK022...
   08NK022: actual mean UAR=15.17 L/s/km2
Estimating FDC for 12103380...
   12103380: actual mean UAR=39.01 L/s/km2
Estimating FDC for 12447383...
   12447383: actual mean UAR=16.06 L/s/km2
Estimating FDC for 12451000...
   12451000: actual mean UAR=49.50 L/s/km2
Estimating FDC for 08NH120...
   08NH120: actual mean UAR=19.89 L/s/km2
Estimating FDC for 12087000...
   12087000: actual mean UAR=31.58 L/s/km2
Estimating FDC for 12462500...
   12462500: actual mean UAR=26.99 L/s/km2
Estimating FDC for 10BE009...
   10BE009: actual mean UAR=5.37 L/s/km2
Processed 680/1093 stations in 0.00 seconds per station
Estimating FDC for 08ME028...
   08ME028: actual mean UAR=52.02 L/s/km2
Estimating FDC for 07AA002...
   07AA002: actual mean UAR=22.60 L/s/km2
Estimating FDC for 10EC001...
   10EC001: actual mean UAR=13.69 L/s/km2
Estimating FDC for 08LA018...
   08LA018: actual mean UAR=48.12 L/s/km2
Estimating FDC for 12340500...
   12340500: actual mean UAR=5.58 L/s/km2
Estimating FDC for 08HF005...
   08HF005: actual mean UAR=74.41 L/s/km2
Estimating FDC for 08NA006...
   08NA006: actual mean UAR=22.09 L/s/km2
Estimating FDC for 10BB001...
   10BB001: actual mean UAR=10.76 L/s/km2
Estimating FDC for 12013500...
   12013500: actual mean UAR=54.13 L/s/km2
Estimating FDC for 12323710...
   12323710: actual mean UAR=5.54 L/s/km2
Processed 690/1093 stations in 0.00 seconds per station
Estimating FDC for 08NL007...
   08NL007: actual mean UAR=13.25 L/s/km2
Estimating FDC for 08EE028...
   08EE028: actual mean UAR=26.06 L/s/km2
Estimating FDC for 08NM171...
   08NM171: actual mean UAR=7.58 L/s/km2
Estimating FDC for 08HC002...
   08HC002: actual mean UAR=94.94 L/s/km2
Estimating FDC for 12413470...
   12413470: actual mean UAR=19.97 L/s/km2
Estimating FDC for 05CC001...
   05CC001: actual mean UAR=1.57 L/s/km2
Estimating FDC for 08HD016...
   08HD016: actual mean UAR=29.17 L/s/km2
Estimating FDC for 08NH130...
   08NH130: actual mean UAR=32.37 L/s/km2
Estimating FDC for 08AC002...
   08AC002: actual mean UAR=16.74 L/s/km2
Estimating FDC for 12208000...
   12208000: actual mean UAR=79.53 L/s/km2
Processed 700/1093 stations in 0.00 seconds per station
Estimating FDC for 12035450...
   12035450: actual mean UAR=127.45 L/s/km2
Estimating FDC for 12178100...
   12178100: actual mean UAR=72.42 L/s/km2
Estimating FDC for 12039005...
   12039005: actual mean UAR=122.31 L/s/km2
Estimating FDC for 12193500...
   12193500: actual mean UAR=98.43 L/s/km2
Estimating FDC for 08LE108...
   08LE108: actual mean UAR=5.27 L/s/km2
Estimating FDC for 08NH006...
   08NH006: actual mean UAR=12.60 L/s/km2
Estimating FDC for 12031000...
   12031000: actual mean UAR=34.22 L/s/km2
Estimating FDC for 08NL050...
   08NL050: actual mean UAR=6.36 L/s/km2
Estimating FDC for 08DB012...
   08DB012: actual mean UAR=46.82 L/s/km2
Estimating FDC for 08FF002...
   08FF002: actual mean UAR=61.65 L/s/km2
Processed 710/1093 stations in 0.00 seconds per station
Estimating FDC for 12113000...
   12113000: actual mean UAR=37.50 L/s/km2
Estimating FDC for 07EE007...
   07EE007: actual mean UAR=30.51 L/s/km2
Estimating FDC for 08LG008...
   08LG008: actual mean UAR=13.20 L/s/km2
Estimating FDC for 12332000...
   12332000: actual mean UAR=10.83 L/s/km2
Estimating FDC for 12391400...
   12391400: actual mean UAR=10.18 L/s/km2
Estimating FDC for 08MH006...
   08MH006: actual mean UAR=80.62 L/s/km2
Estimating FDC for 12338300...
   12338300: actual mean UAR=13.20 L/s/km2
Estimating FDC for 15067900...
   15067900: actual mean UAR=230.10 L/s/km2
Estimating FDC for 08KH030...
   08KH030: actual mean UAR=37.83 L/s/km2
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="example-case-of-bad-kde-fit-due-to-sparse-support-and-precision-vestiges">
<h2><span class="section-number">5.4. </span>Example case of bad KDE fit due to sparse support and precision vestiges<a class="headerlink" href="#example-case-of-bad-kde-fit-due-to-sparse-support-and-precision-vestiges" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_pdf_fig</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>

    <span class="c1"># check y1 (pdf) integrates to 1 over baseline_log_grid</span>
    <span class="n">y1_integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">test_data</span><span class="o">.</span><span class="n">baseline_log_grid</span><span class="p">)</span>

    <span class="c1"># set up a histogram of the observed data</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ts</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ts</span><span class="p">)),</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">xx</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># compute the maximum bin probability mass</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_bin_prob</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">dx</span>  <span class="c1"># bin width</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">hist</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max bin probability mass: </span><span class="si">{</span><span class="n">max_bin_prob</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, y1 integral: </span><span class="si">{</span><span class="n">y1_integral</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># plot the adaptive PMF and the FFTKDE result</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
    <span class="c1"># f = figure(title=f&#39;{target_id}&#39;, width=600, height=400, x_axis_type=&#39;log&#39;)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> 
        <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> 
        <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Observed Histogram&#39;</span><span class="p">)</span>
    <span class="c1"># x_lin = np.exp(test_data.baseline_log_gr)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">baseline_lin_grid</span><span class="p">,</span> <span class="n">adaptive_pdf</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Adaptive BW&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">baseline_lin_grid</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;FFT KDE&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;UAR (L/s/km2)&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Density&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s1">&#39;hide&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">KDEpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">FFTKDE</span>
<span class="n">bad_klds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;05AB022&#39;</span><span class="p">,</span> <span class="s1">&#39;12345000&#39;</span><span class="p">,</span> <span class="s1">&#39;12353820&#39;</span><span class="p">,</span> <span class="s1">&#39;08NL037&#39;</span><span class="p">,</span> <span class="s1">&#39;08NA056&#39;</span><span class="p">,</span> <span class="s1">&#39;08NA052&#39;</span><span class="p">,</span> <span class="s1">&#39;12111500&#39;</span><span class="p">,</span>
            <span class="s1">&#39;08NA053&#39;</span><span class="p">,</span> <span class="s1">&#39;08NH100&#39;</span><span class="p">,</span> <span class="s1">&#39;12367500&#39;</span><span class="p">]</span>
<span class="n">bad_rmses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;15031000&#39;</span><span class="p">,</span> <span class="s1">&#39;12345000&#39;</span><span class="p">,</span> <span class="s1">&#39;12067500&#39;</span><span class="p">,</span> <span class="s1">&#39;08HB045&#39;</span><span class="p">,</span> <span class="s1">&#39;15058700&#39;</span><span class="p">,</span> <span class="s1">&#39;12353820&#39;</span><span class="p">,</span>
           <span class="s1">&#39;15052000&#39;</span><span class="p">,</span> <span class="s1">&#39;15195000&#39;</span><span class="p">,</span> <span class="s1">&#39;15067900&#39;</span><span class="p">,</span> <span class="s1">&#39;08HA069&#39;</span><span class="p">]</span>
<span class="n">bad_nses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;12353820&#39;</span><span class="p">,</span> <span class="s1">&#39;12345000&#39;</span><span class="p">,</span> <span class="s1">&#39;12091060&#39;</span><span class="p">,</span> <span class="s1">&#39;12067500&#39;</span><span class="p">,</span> <span class="s1">&#39;12111500&#39;</span><span class="p">,</span> <span class="s1">&#39;08HB045&#39;</span><span class="p">,</span>
            <span class="s1">&#39;08HB047&#39;</span><span class="p">,</span> <span class="s1">&#39;15031000&#39;</span><span class="p">,</span> <span class="s1">&#39;10CD004&#39;</span><span class="p">,</span> <span class="s1">&#39;12301550&#39;</span><span class="p">]</span>
<span class="c1"># plots = []</span>
<span class="c1"># for target_id in bad_nses:</span>
<span class="c1">#     target_da= stn_da_dict[target_id]</span>
<span class="c1">#     test_data = StationData(context, target_id)</span>
<span class="c1">#     ts = test_data.stn_df[f&#39;{target_id}_uar&#39;].dropna().values</span>

<span class="c1">#     # get the unique UAR values</span>
<span class="c1">#     unique_vals = sorted(np.unique(ts))</span>

<span class="c1">#     df =  test_data.stn_df.copy()</span>
<span class="c1">#     df = df[df[&#39;zero_flow_flag&#39;] == True].copy()</span>


<span class="c1">#     kde_obj = KDEEstimator(test_data.baseline_log_grid, test_data.log_dx)</span>
<span class="c1">#     adaptive_pmf, adaptive_pdf = kde_obj.compute(ts, target_da)</span>


<span class="c1">#     y1 = FFTKDE(bw=&quot;silverman&quot;).fit(np.log(ts)).evaluate(test_data.baseline_log_grid)</span>
<span class="c1">#     f = generate_pdf_fig(y1, test_data, ts)</span>
<span class="c1">#     plots.append(f)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lt</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="a6d869be-ae5a-4b0d-b294-7e4bcc33555d" data-root-id="p1117" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"439f95c5-bf7b-4798-bb24-0c006aeef521":{"version":"3.7.3","title":"Bokeh Application","roots":[{"type":"object","name":"GridPlot","id":"p1117","attributes":{"rows":null,"cols":null,"toolbar":{"type":"object","name":"Toolbar","id":"p1116","attributes":{"tools":[{"type":"object","name":"ToolProxy","id":"p1110","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1025"},{"type":"object","name":"PanTool","id":"p1071"}]}},{"type":"object","name":"ToolProxy","id":"p1111","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1026","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1072","attributes":{"renderers":"auto"}}]}},{"type":"object","name":"ToolProxy","id":"p1112","attributes":{"tools":[{"type":"object","name":"BoxZoomTool","id":"p1027","attributes":{"dimensions":"both","overlay":{"type":"object","name":"BoxAnnotation","id":"p1028","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1034","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1033","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1073","attributes":{"dimensions":"both","overlay":{"type":"object","name":"BoxAnnotation","id":"p1074","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1080","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1079","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}}]}},{"type":"object","name":"SaveTool","id":"p1113"},{"type":"object","name":"ToolProxy","id":"p1114","attributes":{"tools":[{"type":"object","name":"ResetTool","id":"p1036"},{"type":"object","name":"ResetTool","id":"p1082"}]}},{"type":"object","name":"ToolProxy","id":"p1115","attributes":{"tools":[{"type":"object","name":"HelpTool","id":"p1037"},{"type":"object","name":"HelpTool","id":"p1083"}]}}]}},"children":[[{"type":"object","name":"Figure","id":"p1003","attributes":{"width":550,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1004"},"y_range":{"type":"object","name":"DataRange1d","id":"p1005"},"x_scale":{"type":"object","name":"LinearScale","id":"p1013"},"y_scale":{"type":"object","name":"LinearScale","id":"p1014"},"title":{"type":"object","name":"Title","id":"p1006","attributes":{"text":"Predicted log_uar_mean_mean_predicted"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1044","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1038","attributes":{"selected":{"type":"object","name":"Selection","id":"p1039","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1040"},"data":{"type":"map","entries":[["top",{"type":"ndarray","array":{"type":"bytes","data":"IPle8xx7hz8q+V7zHHt3P+A6h7ZVnJE/2DqHtlWcoT8l+V7zHHuXPwAAAAAAAAAA2DqHtlWckT8q+V7zHHunP01LUeejJLA/aiq9hQcUsz8g+V7zHHunPyr5XvMce6c/TUtR56MksD9dtzYw5Fm9PwanbP+V0b4/dLc2MORZvT9yKr2FBxTDPzwiWG3gz8M/O9jKkYBqyj8Y0GV5WSbLP+A6h7ZVnNE/oo1bsH6l1T+rZGI2u1DZPyr5XvMce9c/V6aK+fNx0z/z8Pna9TbYP0V9kX8wHdc/xDqHtlWc0T8Gp2z/ldHOP9CeB+dujc8/Bqds/5XRzj9hAcQLRL/GPz6v0Re9Fc4/PCJYbeDP0z9Xpor583HTP+LHAGEy4ss/NEtR56MksD8q+V7zHHuXPyr5XvMce4c/Kvle8xx7hz8="},"shape":[40],"dtype":"float64","order":"little"}],["left",{"type":"ndarray","array":{"type":"bytes","data":"h8+MNKeh+L8itiaj6xb2v76cwBEwjPO/WoNagHQB8b/q0+jdce3svyGhHLv61+e/WG5QmIPC4r8cdwjrGFrbv4wRcKUqL9G/8K9ef/EQvL/AzAUujzWpP1g+slZAo8o/vITxcI581z8m9URbvtPgP/InEX416eU/ulrdoKz+6j/BxtThEQrwPyXgOnPNlPI/ifmgBIkf9T/vEgeWRKr3P1MsbScANfo/t0XTuLu//D8dXzlKd0r/P0C8z22Z6gBA8siCNvcvAkCk1TX/VHUDQFbi6MeyugRACO+bkBAABkC8+05ZbkUHQG4IAiLMighAIBW16inQCUDSIWizhxULQIQuG3zlWgxANjvOREOgDUDoR4ENoeUOQE0qGmt/FRBAprBzTy64EEAAN80z3VoRQFm9JhiM/RFAskOA/DqgEkA="},"shape":[40],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"IrYmo+sW9r++nMARMIzzv1qDWoB0AfG/6tPo3XHt7L8hoRy7+tfnv1huUJiDwuK/HHcI6xha27+MEXClKi/Rv/CvXn/xELy/wMwFLo81qT9YPrJWQKPKP7yE8XCOfNc/JvVEW77T4D/yJxF+NenlP7pa3aCs/uo/wcbU4REK8D8l4DpzzZTyP4n5oASJH/U/7xIHlkSq9z9TLG0nADX6P7dF07i7v/w/HV85SndK/z9AvM9tmeoAQPLIgjb3LwJApNU1/1R1A0BW4ujHsroEQAjvm5AQAAZAvPtOWW5FB0BuCAIizIoIQCAVteop0AlA0iFos4cVC0CELht85VoMQDY7zkRDoA1A6EeBDaHlDkBNKhprfxUQQKawc08uuBBAADfNM91aEUBZvSYYjP0RQLJDgPw6oBJAC8rZ4OlCE0A="},"shape":[40],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1045","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1046"}}},"glyph":{"type":"object","name":"Quad","id":"p1041","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"fill_color":{"type":"value","value":"lightblue"}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1042","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1043","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1012","attributes":{"tools":[{"id":"p1025"},{"id":"p1026"},{"id":"p1027"},{"type":"object","name":"SaveTool","id":"p1035"},{"id":"p1036"},{"id":"p1037"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1020","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1021","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1022"},"axis_label":"$$P(x)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1023"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1015","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1016","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1017"},"axis_label":"$$\\text{Log Mean UAR }(L/s/\\text{km}^2)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1018"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"center":[{"type":"object","name":"Grid","id":"p1019","attributes":{"axis":{"id":"p1015"}}},{"type":"object","name":"Grid","id":"p1024","attributes":{"dimension":1,"axis":{"id":"p1020"}}},{"type":"object","name":"Legend","id":"p1047","attributes":{"label_text_font":"Bitstream Charter","label_text_font_size":"12pt","items":[{"type":"object","name":"LegendItem","id":"p1048","attributes":{"label":{"type":"value","value":""},"renderers":[{"id":"p1044"}]}}]}}]}},0,0],[{"type":"object","name":"Figure","id":"p1049","attributes":{"width":550,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1050"},"y_range":{"type":"object","name":"DataRange1d","id":"p1051"},"x_scale":{"type":"object","name":"LinearScale","id":"p1059"},"y_scale":{"type":"object","name":"LinearScale","id":"p1060"},"title":{"type":"object","name":"Title","id":"p1052","attributes":{"text":"Predicted log_uar_std_mean_predicted"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1090","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1084","attributes":{"selected":{"type":"object","name":"Selection","id":"p1085","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1086"},"data":{"type":"map","entries":[["top",{"type":"ndarray","array":{"type":"bytes","data":"8FgmWx7mqT+zwlzElmzTPw0kiybiIt0/iPYWWM014j+qih6tSbvsPxJAKrKIe/g/crwW/3SQ/z+uUCwK6hgBQEDW80gQ9f4/Cnamh8o48z+jwJqCi3jnP4739/jSL+A/x43Bj1qp1j/0j4PRZZ3SP/tYJlse5sk/x43Bj1qptj+PiT0MRMHOP7vCXMSWbLM/3I3Bj1qptj/kWCZbHuapPwAAAAAAAAAAAAAAAAAAAAARWSZbHuaZP+RYJlse5pk/q8JcxJZsoz8RWSZbHuaJP+RYJlse5pk/5FgmWx7miT/kWCZbHuaZPwAAAAAAAAAA5FgmWx7miT8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAORYJlse5ok/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5FgmWx7miT8="},"shape":[40],"dtype":"float64","order":"little"}],["left",{"type":"ndarray","array":{"type":"bytes","data":"TL8rH9Wy4j83v7WhzwDlPyK/PyTKTuc/Db/JpsSc6T/4vlMpv+rrP+O+3au5OO4/Z98zF1pD8D9c33hYV2rxP1LfvZlUkfI/SN8C21G48z8930ccT9/0PzLfjF1MBvY/KN/Rnkkt9z8e3xbgRlT4PxPfWyFEe/k/CN+gYkGi+j/+3uWjPsn7P/TeKuU78Pw/6d5vJjkX/j/e3rRnNj7/P2rvfNSZMgBAZW8fdRjGAEBg78EVl1kBQFpvZLYV7QFAVe8GV5SAAkBQb6n3EhQDQErvS5iRpwNARW/uOBA7BEBA75DZjs4EQDtvM3oNYgVANe/VGoz1BUAwb3i7CokGQCvvGlyJHAdAJm+9/AewB0Ah71+dhkMIQBtvAj4F1whAFu+k3oNqCUARb0d/Av4JQAvv6R+BkQpABm+MwP8kC0A="},"shape":[40],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"N7+1oc8A5T8ivz8kyk7nPw2/yabEnOk/+L5TKb/q6z/jvt2ruTjuP2ffMxdaQ/A/XN94WFdq8T9S372ZVJHyP0jfAttRuPM/Pd9HHE/f9D8y34xdTAb2Pyjf0Z5JLfc/Ht8W4EZU+D8T31shRHv5PwjfoGJBovo//t7loz7J+z/03irlO/D8P+nebyY5F/4/3t60ZzY+/z9q73zUmTIAQGVvH3UYxgBAYO/BFZdZAUBab2S2Fe0BQFXvBleUgAJAUG+p9xIUA0BK70uYkacDQEVv7jgQOwRAQO+Q2Y7OBEA7bzN6DWIFQDXv1RqM9QVAMG94uwqJBkAr7xpciRwHQCZvvfwHsAdAIe9fnYZDCEAbbwI+BdcIQBbvpN6DaglAEW9HfwL+CUAL7+kfgZEKQAZvjMD/JAtAAe8uYX64C0A="},"shape":[40],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1091","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1092"}}},"glyph":{"type":"object","name":"Quad","id":"p1087","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"fill_color":{"type":"value","value":"lightblue"}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1088","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1089","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"lightblue"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1058","attributes":{"tools":[{"id":"p1071"},{"id":"p1072"},{"id":"p1073"},{"type":"object","name":"SaveTool","id":"p1081"},{"id":"p1082"},{"id":"p1083"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1066","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1067","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1068"},"axis_label":"$$P(x)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1069"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1061","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1062","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1063"},"axis_label":"$$\\text{Log SD UAR }(L/s/\\text{km}^2)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"14pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1064"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"12pt"}}],"center":[{"type":"object","name":"Grid","id":"p1065","attributes":{"axis":{"id":"p1061"}}},{"type":"object","name":"Grid","id":"p1070","attributes":{"dimension":1,"axis":{"id":"p1066"}}},{"type":"object","name":"Legend","id":"p1093","attributes":{"label_text_font":"Bitstream Charter","label_text_font_size":"12pt","items":[{"type":"object","name":"LegendItem","id":"p1094","attributes":{"label":{"type":"value","value":""},"renderers":[{"id":"p1090"}]}}]}}]}},0,1]]}}]}};
  const render_items = [{"docid":"439f95c5-bf7b-4798-bb24-0c006aeef521","roots":{"p1117":"a6d869be-ae5a-4b0d-b294-7e4bcc33555d"},"root_ids":["p1117"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<section id="compute-the-complexity-of-searching-the-space-of-k-nearest-neighbours-for-the-optimal-ensemble">
<h3><span class="section-number">5.4.1. </span>Compute the complexity of searching the space of k-nearest neighbours for the optimal ensemble<a class="headerlink" href="#compute-the-complexity-of-searching-the-space-of-k-nearest-neighbours-for-the-optimal-ensemble" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">comb</span>
<span class="c1"># from bokeh.plotting import figure, show, output_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">BasicTicker</span><span class="p">,</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">linear_cmap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.palettes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Viridis256</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_search_space_heatmap</span><span class="p">(</span><span class="n">N_min</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">N_max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">N_step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">k_max</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span><span class="c1"># output_path=&quot;search_space_heatmap.html&quot;):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate and save a Bokeh heatmap of log10(search space size) for ensembles of size 1 to k_max</span>
<span class="sd">    from a network of size N, excluding the target node.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - N_min (int): Minimum network size.</span>
<span class="sd">    - N_max (int): Maximum network size.</span>
<span class="sd">    - N_step (int): Step between network sizes.</span>
<span class="sd">    - k_max (int): Maximum ensemble size to consider.</span>
<span class="sd">    - output_path (str): Path to save the HTML output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N_min</span><span class="p">,</span> <span class="n">N_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_step</span><span class="p">)</span>
    <span class="n">k_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">N_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_values</span><span class="p">:</span>
            <span class="n">max_j</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;search_space&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_search_space&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;search_space&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">mapper</span> <span class="o">=</span> <span class="n">linear_cmap</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;log_search_space&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">Viridis256</span><span class="p">,</span>
                         <span class="n">low</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_search_space&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">high</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_search_space&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span>
        <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;@N&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;@k&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Search space&quot;</span><span class="p">,</span> <span class="s2">&quot;@search_space{0,0}&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;log10(Search space)&quot;</span><span class="p">,</span> <span class="s2">&quot;@log_search_space</span><span class="si">{0.00}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Log10 of Search Space Size vs N and k&quot;</span><span class="p">,</span>
               <span class="n">x_axis_label</span><span class="o">=</span><span class="s1">&#39;Network size N&#39;</span><span class="p">,</span>
               <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39;Ensemble size k&#39;</span><span class="p">,</span>
               <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="n">N_min</span><span class="p">,</span> <span class="n">N_max</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_max</span><span class="p">),</span>
               <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span>
               <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pan&#39;</span><span class="p">,</span> <span class="s1">&#39;wheel_zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;box_zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="n">hover</span><span class="p">])</span>

    <span class="n">p</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">N_step</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
           <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">mapper</span><span class="p">)</span>

    <span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">],</span> <span class="n">ticker</span><span class="o">=</span><span class="n">BasicTicker</span><span class="p">(),</span>
                         <span class="n">label_standoff</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;log10(search space)&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig = plot_search_space_heatmap()</span>
<span class="c1"># show(fig)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-how-biased-a-quantile-based-spread-estimate-is-at-different-resolutions">
<h3><span class="section-number">5.4.2. </span>Evaluate how biased a quantile-based spread estimate is at different resolutions<a class="headerlink" href="#evaluate-how-biased-a-quantile-based-spread-estimate-is-at-different-resolutions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">percentile_spread_convergence</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">percentiles_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare the standard deviation of observed data to that estimated from percentiles.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - obs: 1D array-like of observed values</span>
<span class="sd">    - percentiles_list: list of lists/arrays of percentiles to compute (0–100).</span>
<span class="sd">      If None, defaults to increasingly fine resolutions.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - pd.DataFrame with columns:</span>
<span class="sd">        &#39;num_percentiles&#39;, &#39;percentiles&#39;, &#39;spread_std&#39;, &#39;sample_std&#39;, &#39;relative_error&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sample_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">percentiles_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">percentiles_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">99.99</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> 
                           <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pct_set</span> <span class="ow">in</span> <span class="n">percentiles_list</span><span class="p">:</span>
        <span class="n">q_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pct_set</span><span class="p">)</span>
        <span class="n">spread_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">q_vals</span><span class="p">)</span>
        <span class="n">rel_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">spread_std</span> <span class="o">-</span> <span class="n">sample_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_std</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;num_percentiles&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">pct_set</span><span class="p">),</span>
            <span class="s1">&#39;percentiles&#39;</span><span class="p">:</span> <span class="n">pct_set</span><span class="p">,</span>
            <span class="s1">&#39;spread_std&#39;</span><span class="p">:</span> <span class="n">spread_std</span><span class="p">,</span>
            <span class="s1">&#39;sample_std&#39;</span><span class="p">:</span> <span class="n">sample_std</span><span class="p">,</span>
            <span class="s1">&#39;relative_error&#39;</span><span class="p">:</span> <span class="n">rel_error</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_id</span> <span class="o">=</span> <span class="s1">&#39;08MH147&#39;</span>
<span class="n">target_da</span><span class="o">=</span> <span class="n">stn_da_dict</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">StationData</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span>

<span class="c1"># get the unique UAR values</span>
<span class="n">df</span> <span class="o">=</span>  <span class="n">test_data</span><span class="o">.</span><span class="n">stn_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_id</span><span class="si">}</span><span class="s1">_uar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">percentile_spread_convergence</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">LinearColorMapper</span><span class="p">,</span> <span class="n">BasicTicker</span><span class="p">,</span> <span class="n">LogColorMapper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">transform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.palettes</span><span class="w"> </span><span class="kn">import</span> <span class="n">RdBu11</span><span class="p">,</span> <span class="n">RdBu10</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">PrintfTickFormatter</span><span class="p">,</span> <span class="n">CustomJSTickFormatter</span>

<span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>

<span class="c1"># Convert axis values to strings for categorical plotting</span>
<span class="n">deltas_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">deltas</span><span class="p">]</span>
<span class="n">P_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P</span><span class="p">]</span>

<span class="c1"># Prepare a matrix to store relative error</span>
<span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">deltas</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span>
<span class="n">sample_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Fill the matrix</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deltas</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">d</span>
        <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">q_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)</span>
        <span class="n">spread_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">q_vals</span><span class="p">)</span>
        <span class="n">rel_error</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">spread_std</span> <span class="o">-</span> <span class="n">sample_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_std</span>
        <span class="n">heatmap_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_error</span>

<span class="c1"># Prepare dataframe for Bokeh</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">deltas_str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">P_str</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;delta&#39;</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;rel_error&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_rel_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rel_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Set up color mapper</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">LinearColorMapper</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="n">RdBu11</span><span class="p">,</span>
                           <span class="n">low</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">log_rel_error</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                           <span class="n">high</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">log_rel_error</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Create figure</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">P_str</span><span class="p">,</span>
           <span class="n">y_range</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">deltas_str</span><span class="p">)),</span>
           <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Number of Percentiles&quot;</span><span class="p">,</span>
           <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Symmetric Exclusion from [0, 100] (%)&quot;</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relative Error of Quantile-based Std Dev vs Sample Std Dev&quot;</span><span class="p">,</span>
           <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
           <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
           <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Add heatmap rectangles</span>
<span class="n">p</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
       <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;log_rel_error&#39;</span><span class="p">,</span> <span class="n">mapper</span><span class="p">))</span>

<span class="n">formatter</span> <span class="o">=</span> <span class="n">CustomJSTickFormatter</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    return Math.exp(tick).toFixed(1);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Add color bar</span>
<span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">,</span> <span class="n">ticker</span><span class="o">=</span><span class="n">BasicTicker</span><span class="p">(</span><span class="n">desired_num_ticks</span><span class="o">=</span><span class="mi">11</span><span class="p">),</span>
                     <span class="n">label_standoff</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> 
                     <span class="c1"># formatter=PrintfTickFormatter(format=&quot;%d%%&quot;),</span>
                     <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
                     <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Relative (Absolute) Error in Quantile-based Stdev. [%]&#39;</span>
                    <span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span>
    <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Percentiles&quot;</span><span class="p">,</span> <span class="s2">&quot;@P&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Exclusion (%)&quot;</span><span class="p">,</span> <span class="s2">&quot;@delta_float&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Rel. Error&quot;</span><span class="p">,</span> <span class="s2">&quot;@rel_error</span><span class="si">{0.0}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span>
<span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="bd0eedf8-0e8a-425b-b5f4-83e28663c1c8" data-root-id="p1129" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"aabffdc8-8e28-4b95-bae7-ef39da3a36a9":{"version":"3.7.3","title":"Bokeh Application","roots":[{"type":"object","name":"Figure","id":"p1129","attributes":{"width":900,"height":400,"x_range":{"type":"object","name":"FactorRange","id":"p1139","attributes":{"factors":["10","20","50","100","200","500","1000","2000","5000","10000"]}},"y_range":{"type":"object","name":"FactorRange","id":"p1140","attributes":{"factors":["10","5","2","1","0.5","0.2","0.1","0.05","0.02","0.01","0"]}},"x_scale":{"type":"object","name":"CategoricalScale","id":"p1141"},"y_scale":{"type":"object","name":"CategoricalScale","id":"p1142"},"title":{"type":"object","name":"Title","id":"p1132","attributes":{"text":"Relative Error of Quantile-based Std Dev vs Sample Std Dev"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1159","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1125","attributes":{"selected":{"type":"object","name":"Selection","id":"p1126","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1127"},"data":{"type":"map","entries":[["index",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAAAARAAAAEgAAABMAAAAUAAAAFQAAABYAAAAXAAAAGAAAABkAAAAaAAAAGwAAABwAAAAdAAAAHgAAAB8AAAAgAAAAIQAAACIAAAAjAAAAJAAAACUAAAAmAAAAJwAAACgAAAApAAAAKgAAACsAAAAsAAAALQAAAC4AAAAvAAAAMAAAADEAAAAyAAAAMwAAADQAAAA1AAAANgAAADcAAAA4AAAAOQAAADoAAAA7AAAAPAAAAD0AAAA+AAAAPwAAAEAAAABBAAAAQgAAAEMAAABEAAAARQAAAEYAAABHAAAASAAAAEkAAABKAAAASwAAAEwAAABNAAAATgAAAE8AAABQAAAAUQAAAFIAAABTAAAAVAAAAFUAAABWAAAAVwAAAFgAAABZAAAAWgAAAFsAAABcAAAAXQAAAF4AAABfAAAAYAAAAGEAAABiAAAAYwAAAGQAAABlAAAAZgAAAGcAAABoAAAAaQAAAGoAAABrAAAAbAAAAG0AAAA="},"shape":[110],"dtype":"int32","order":"little"}],["delta",{"type":"ndarray","array":["0","0","0","0","0","0","0","0","0","0","0.01","0.01","0.01","0.01","0.01","0.01","0.01","0.01","0.01","0.01","0.02","0.02","0.02","0.02","0.02","0.02","0.02","0.02","0.02","0.02","0.05","0.05","0.05","0.05","0.05","0.05","0.05","0.05","0.05","0.05","0.1","0.1","0.1","0.1","0.1","0.1","0.1","0.1","0.1","0.1","0.2","0.2","0.2","0.2","0.2","0.2","0.2","0.2","0.2","0.2","0.5","0.5","0.5","0.5","0.5","0.5","0.5","0.5","0.5","0.5","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","5","5","5","5","5","5","5","5","5","5","10","10","10","10","10","10","10","10","10","10"],"shape":[110],"dtype":"object","order":"little"}],["P",{"type":"ndarray","array":["10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000","10","20","50","100","200","500","1000","2000","5000","10000"],"shape":[110],"dtype":"object","order":"little"}],["rel_error",{"type":"ndarray","array":{"type":"bytes","data":"IF/yzG8WgECHh2Gs8bx1QMd6Z4qILmhAnlgNpANPXUDLfSOetsJQQDKT97W/Dj1AXb0tU/tNLECFjOD+VA4aQEdZjprxz/4/OGwHBjTr2j86jpLSu2t0QLNG6XaFkGpAWOFdD8hSW0DD4XPmy1xOQHFc/xsE/D5AEZNKanCkJUDy7oFERRAOQAmqEQGFEt4/2Z5CWzu28b8KbSnlu/r5v/6DBWf0OXJAfUV1iJJsZ0DNyiolsXtXQMFH14RhTUlAwBQi1cXCOEB0K2GrMuIeQHpdj6WGEf4/pyRd3GRv77/3DH0b5SYBwP57dgEj0gTAZ+4hLpgDbEDYikxLR2phQGacek2nPVBAh0ekwaTBP0CEDRN9xXwqQCQQqN8ezf8/5IUEQ8V2+7/Qr3h1xvQLwHSkSJoCcBLA+/a2x5aYE8A+mY8HRgRlQCA9yh7J81hAdbUNhNbQRED9GMYKTCoxQI8EWo6bjBFAQBPFgS+GCMD6qt/lUzwVwByRINgxURnAwP7yBGTbG8BUO/Zo06ocwE0TSLchp19A3S4H++yzUUBi6Z3Z8/A4QK4D/DRKQhpAH5j/dacUBMCmwQPAsnIewLKPR0ECYyLArtIZvDfAI8Cd0DkF46kkwG553UAX8CTANvHFjSMSUUBxjzu5Scs+QKyVaUyD0QJAkPz//j2OH8C8jxo1g0ApwINU42zUhS7AtGmu8H4KMMCFlLYWmW4wwHtR0bN2rDDA4Cn+Zb6+MMDLXrgF1fU8QLrod7fLehJAAZ8N9blcKMCllr+yPcIxwPrIr26RUTTARpbIn5vYNcAecch5p042wJ40NytciDbA0KoUq/OoNsDLxOYK7rQ2wMT6DR+5YQXAG3g8GM3xL8D/qiXLefM3wIZFZyOphzrA5ls3fXyrO8C1Ju/tKV88wLwTYtThljzAJRqlNTyyPMDh+xpPAsI8wJ0YXIB/xzzAqy5BJGWvOcDsLuojSTRAwH367wACHkLAfbKh4tO6QsBZ44jiDwNDwA786AaoMEPAJOM/BgFAQ8B5D02L7EZDwG7n/Rl3S0PA/CwfT/dMQ8CVuOSyQp1EwHbOO7RKxEbA9tyuPSz0R8DtDB66cVZIwLel8WeDhkjAu5pznsyiSMCRAIBfZqxIwFKNilPmsEjAnFjVYwe0SMA2jxus67RIwA=="},"shape":[110],"dtype":"float64","order":"little"}],["log_rel_error",{"type":"ndarray","array":{"type":"bytes","data":"1WDvZqP5GEAoF+jZF2gXQD4bNc9mDxVAUd59bIQOE0BBDrfEQNIQQGbUl1ZJ9ApAWKXgF/MyBUC46WpBtvv9P1j00Utr+OQ/TKmwgsK2679wK+t4FSgXQIHIBJaibxVAW+lphbHGEkDb7cBU6GwQQGtZEQXHdwtALKncL1INA0DVVO+TlC71P+AO4Rk7K+i/1vfFyWQFuj+z1wCmlwXfPw33lYersxZAL/Sr7M3uFEBT7iCumSsSQJX7Zr9vZA9AD8SvFpKsCUD4W0g4+FkAQJtNJTY8MOQ/el6/mLg8kr91CQqTyWfoP23PUorBm+4/fanH9gmmFUCtHSzNQ78TQOmDuav+sRBAsNL2qi2qC0ApfCRWDasEQD1ztEA5++U/LdfzpgRK4T9GdTff5QT0PztATiQTc/g/XQh1l65s+T8BNpu3wH8UQN5/V/S8aRJA/tLinLPUDUAjnlW0Or4GQHc0OuvSqPc/xJR7/Gjs8T/J3k1pz7X6P/rFBTTkhf0/uoxOinkN/z/B8X7v6oL/PwmUb0xPXRNA4tR1dUIKEUDWDz/Ub7sJQOE34mF+G/4/neVE3Dtz7T+ozMKl4TwAQMCHfCp0vwFAeb1/ZwVSAkDGn3jBi64CQJBAEAKMyQJAXEdH9QjlEEBbjtZFKGsLQMaag2xjX+s/OosTuQ6GAEAPaKegO0kEQPpG9KV3zQVADMhqv4AzBkDVofLJ02QGQIE3oD+6ggZAGsZEw3qLBkA55Lo9au0KQHVEE31sfPg/NVdCRsT/A0C2JPLp2AMHQD6RTjihFwhAcpEfiRSsCEB0P9LM29YIQG3QlRxz6whAS954Df32CEDdxZSBNvsIQBRbr1KEde8/MSgye7UqBkAHBA2peWgJQKYmkV3nOQpAQDp0iBCQCkDVSu+WXcMKQN2lej4E0wpASrHTBqjaCkAYOfyRDN8KQEf89FOT4ApA3W79+KD3CUAvOK31zdMLQBso1iFXuAxAeJ3nMnH8DECj/7e5EBsNQN0+aFspLg1A+XPWu4w0DUBjbcZubDcNQHvpeKxOOQ1ASgMX8+05DUDlqidayMANQAb9ofkujA5AYTmLAkb0DkCg4Ftm1RQPQLtPaNuSJA9Aqg+7k8ctD0A/efIS5TAPQJma6nFaMg9ACYTS7V0zD0D2BwjapzMPQA=="},"shape":[110],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1160","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1161"}}},"glyph":{"type":"object","name":"Rect","id":"p1156","attributes":{"x":{"type":"field","field":"P"},"y":{"type":"field","field":"delta"},"width":{"type":"value","value":1},"height":{"type":"value","value":1},"line_color":{"type":"value","value":null},"fill_color":{"type":"field","field":"log_rel_error","transform":{"type":"object","name":"LinearColorMapper","id":"p1128","attributes":{"palette":["#053061","#2166ac","#4393c3","#92c5de","#d1e5f0","#f7f7f7","#fddbc7","#f4a582","#d6604d","#b2182b","#67001f"],"low":-0.866059546712941,"high":6.243787392006387}}}}},"nonselection_glyph":{"type":"object","name":"Rect","id":"p1157","attributes":{"x":{"type":"field","field":"P"},"y":{"type":"field","field":"delta"},"width":{"type":"value","value":1},"height":{"type":"value","value":1},"line_color":{"type":"value","value":null},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"field","field":"log_rel_error","transform":{"id":"p1128"}},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Rect","id":"p1158","attributes":{"x":{"type":"field","field":"P"},"y":{"type":"field","field":"delta"},"width":{"type":"value","value":1},"height":{"type":"value","value":1},"line_color":{"type":"value","value":null},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"field","field":"log_rel_error","transform":{"id":"p1128"}},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1138","attributes":{"tools":[{"type":"object","name":"HoverTool","id":"p1166","attributes":{"renderers":"auto","tooltips":[["Percentiles","@P"],["Exclusion (%)","@delta_float"],["Rel. Error","@rel_error{0.0}%"]]}}]}},"left":[{"type":"object","name":"CategoricalAxis","id":"p1148","attributes":{"ticker":{"type":"object","name":"CategoricalTicker","id":"p1149"},"formatter":{"type":"object","name":"CategoricalTickFormatter","id":"p1150"},"axis_label":"Symmetric Exclusion from [0, 100] (%)","major_label_policy":{"type":"object","name":"AllLabels","id":"p1151"}}}],"right":[{"type":"object","name":"ColorBar","id":"p1164","attributes":{"location":[0,0],"title":"Relative (Absolute) Error in Quantile-based Stdev. [%]","ticker":{"type":"object","name":"BasicTicker","id":"p1163","attributes":{"desired_num_ticks":11,"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"CustomJSTickFormatter","id":"p1162","attributes":{"code":"\n    return Math.exp(tick).toFixed(1);\n"}},"major_label_policy":{"type":"object","name":"NoOverlap","id":"p1165"},"label_standoff":12,"color_mapper":{"id":"p1128"}}}],"below":[{"type":"object","name":"CategoricalAxis","id":"p1143","attributes":{"ticker":{"type":"object","name":"CategoricalTicker","id":"p1144"},"formatter":{"type":"object","name":"CategoricalTickFormatter","id":"p1145"},"axis_label":"Number of Percentiles","major_label_policy":{"type":"object","name":"AllLabels","id":"p1146"}}}],"center":[{"type":"object","name":"Grid","id":"p1147","attributes":{"axis":{"id":"p1143"}}},{"type":"object","name":"Grid","id":"p1152","attributes":{"dimension":1,"axis":{"id":"p1148"}}}]}}]}};
  const render_items = [{"docid":"aabffdc8-8e28-4b95-bae7-ef39da3a36a9","roots":{"p1129":"bd0eedf8-0e8a-425b-b5f4-83e28663c1c8"},"root_ids":["p1129"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compare_quantile_std_and_mse_bias</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute % relative error in standard deviation and MSE for two quantile sampling strategies:</span>
<span class="sd">    </span>
<span class="sd">    - Case A: np.arange(1, 99, 1)</span>
<span class="sd">    - Case B: [1, 5, 10, 50, 90, 95, 99]</span>

<span class="sd">    Parameters:</span>
<span class="sd">        stn (str): station ID</span>
<span class="sd">        values (array-like): 1D array of numeric values</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: {</span>
<span class="sd">            &#39;stn_id&#39;: str,</span>
<span class="sd">            &#39;a_err&#39;: float (% rel error in std dev),</span>
<span class="sd">            &#39;b_err&#39;: float,</span>
<span class="sd">            &#39;a_mse&#39;: float (MSE of q_vals_a vs true q_vals),</span>
<span class="sd">            &#39;b_mse&#39;: float,</span>
<span class="sd">            &#39;sample_std&#39;: float,</span>
<span class="sd">            &#39;std_case_a&#39;: float,</span>
<span class="sd">            &#39;std_case_b&#39;: float</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
    <span class="n">sample_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="n">percentiles_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># percentiles_b = [1, 5, 10, 50, 90, 95, 99]</span>
    <span class="n">percentiles_b</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">]</span>

    <span class="c1"># &quot;Observed&quot; quantiles</span>
    <span class="n">q_vals_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">percentiles_a</span><span class="p">)</span>
    <span class="n">q_vals_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">percentiles_b</span><span class="p">)</span>

    <span class="n">std_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">q_vals_a</span><span class="p">)</span>
    <span class="n">std_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">q_vals_b</span><span class="p">)</span>

    <span class="n">rel_error_a</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">std_a</span> <span class="o">-</span> <span class="n">sample_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_std</span>
    <span class="n">rel_error_b</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">std_b</span> <span class="o">-</span> <span class="n">sample_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_std</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stn_id&#39;</span><span class="p">:</span> <span class="n">stn</span><span class="p">,</span>
        <span class="s1">&#39;a_err&#39;</span><span class="p">:</span> <span class="n">rel_error_a</span><span class="p">,</span>
        <span class="s1">&#39;b_err&#39;</span><span class="p">:</span> <span class="n">rel_error_b</span><span class="p">,</span>
        <span class="s1">&#39;sample_std&#39;</span><span class="p">:</span> <span class="n">sample_std</span><span class="p">,</span>
        <span class="s1">&#39;std_case_a&#39;</span><span class="p">:</span> <span class="n">std_a</span><span class="p">,</span>
        <span class="s1">&#39;std_case_b&#39;</span><span class="p">:</span> <span class="n">std_b</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stn_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">official_ids</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">daymet_concurrent_stations</span><span class="p">]</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">stn_set</span><span class="p">:</span>
    <span class="n">target_da</span><span class="o">=</span> <span class="n">stn_da_dict</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">StationData</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">stn</span><span class="p">)</span>
    
    <span class="c1"># get the unique UAR values</span>
    <span class="n">df</span> <span class="o">=</span>  <span class="n">test_data</span><span class="o">.</span><span class="n">stn_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_uar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="n">log_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="c1"># sdf = percentile_spread_convergence(vals)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">compare_quantile_std_and_mse_bias</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">log_vals</span><span class="p">)</span>
    <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stn_set</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50/719
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100/719
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">stn_set</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">target_da</span><span class="o">=</span> <span class="n">stn_da_dict</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">5</span>     <span class="n">test_data</span> <span class="o">=</span> <span class="n">StationData</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">stn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="c1"># get the unique UAR values</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">df</span> <span class="o">=</span>  <span class="n">test_data</span><span class="o">.</span><span class="n">stn_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nn">File ~/code/distribution_estimation/docs/notebooks/utils/fdc_data.py:26,</span> in <span class="ni">StationData.__init__</span><span class="nt">(self, context, stn)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSTM_ensemble_result_folder</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">LSTM_ensemble_result_folder</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_da</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_gdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attr_gdf</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stn</span><span class="p">][</span><span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">26</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_target_streamflow_data</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="c1"># self._set_grid()</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="c1"># self.eval_metrics = EvaluationMetrics(self.baseline_log_grid, self.log_dx)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="c1"># self._set_divergence_measure_functions()</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_baseline_distribution</span><span class="p">()</span>

<span class="nn">File ~/code/distribution_estimation/docs/notebooks/utils/fdc_data.py:88,</span> in <span class="ni">StationData._initialize_target_streamflow_data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_target_streamflow_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span>     <span class="c1"># self.stn_df = dpf.get_timeseries_data(self.target_stn)</span>
<span class="ne">---&gt; </span><span class="mi">88</span>     <span class="bp">self</span><span class="o">.</span><span class="n">stn_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_timeseries_discharge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_stn</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="bp">self</span><span class="o">.</span><span class="n">uar_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_stn</span><span class="si">}</span><span class="s1">_uar&#39;</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>     <span class="bp">self</span><span class="o">.</span><span class="n">n_observations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uar_label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

<span class="nn">File ~/code/distribution_estimation/docs/notebooks/utils/fdc_data.py:71,</span> in <span class="ni">StationData.retrieve_timeseries_discharge</span><span class="nt">(self, stn)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span> <span class="k">def</span><span class="w"> </span><span class="nf">retrieve_timeseries_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">watershed_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">official_id_dict</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">71</span>     <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;discharge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">watershed</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">watershed_id</span><span class="p">))</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;discharge&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>     <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)[[</span><span class="s1">&#39;discharge&#39;</span><span class="p">]]</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>     <span class="c1"># regardless of whether the INPUT data is clipped to </span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>     <span class="c1"># match the LSTM input data, the target data should be clipped</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>     <span class="c1"># such that the target distribution is held constant</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/dataarray.py:3963,</span> in <span class="ni">DataArray.to_dataframe</span><span class="nt">(self, name, dim_order)</span>
<span class="g g-Whitespace">   </span><span class="mi">3960</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3961</span>     <span class="n">ordered_dims</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">_normalize_dim_order</span><span class="p">(</span><span class="n">dim_order</span><span class="o">=</span><span class="n">dim_order</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3963</span> <span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">_to_dataframe</span><span class="p">(</span><span class="n">ordered_dims</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3964</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">unique_name</span> <span class="k">else</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">3965</span> <span class="k">return</span> <span class="n">df</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/dataset.py:7087,</span> in <span class="ni">Dataset._to_dataframe</span><span class="nt">(self, ordered_dims)</span>
<span class="g g-Whitespace">   </span><span class="mi">7081</span> <span class="kn">from</span><span class="w"> </span><span class="nn">xarray.core.extension_array</span><span class="w"> </span><span class="kn">import</span> <span class="n">PandasExtensionArray</span>
<span class="g g-Whitespace">   </span><span class="mi">7083</span> <span class="n">columns_in_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">7084</span> <span class="n">non_extension_array_columns</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">   </span><span class="mi">7085</span>     <span class="n">k</span>
<span class="g g-Whitespace">   </span><span class="mi">7086</span>     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">columns_in_order</span>
<span class="ne">-&gt; </span><span class="mi">7087</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">is_extension_array_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7088</span> <span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">7089</span> <span class="n">extension_array_columns</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">   </span><span class="mi">7090</span>     <span class="n">k</span>
<span class="g g-Whitespace">   </span><span class="mi">7091</span>     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">columns_in_order</span>
<span class="g g-Whitespace">   </span><span class="mi">7092</span>     <span class="k">if</span> <span class="n">is_extension_array_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">7093</span> <span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">7094</span> <span class="n">extension_array_columns_different_index</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">   </span><span class="mi">7095</span>     <span class="n">k</span>
<span class="g g-Whitespace">   </span><span class="mi">7096</span>     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">extension_array_columns</span>
<span class="g g-Whitespace">   </span><span class="mi">7097</span>     <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordered_dims</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="g g-Whitespace">   </span><span class="mi">7098</span> <span class="p">]</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/variable.py:430,</span> in <span class="ni">Variable.data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">428</span>     <span class="n">duck_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">array</span>
<span class="g g-Whitespace">    </span><span class="mi">429</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">indexing</span><span class="o">.</span><span class="n">ExplicitlyIndexed</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">430</span>     <span class="n">duck_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get_duck_array</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">431</span> <span class="k">elif</span> <span class="n">is_duck_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">432</span>     <span class="n">duck_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/indexing.py:845,</span> in <span class="ni">MemoryCachedArray.get_duck_array</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">844</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_duck_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">845</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_cached</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">846</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get_duck_array</span><span class="p">()</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/indexing.py:842,</span> in <span class="ni">MemoryCachedArray._ensure_cached</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">841</span> <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_cached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">842</span>     <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">as_indexable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get_duck_array</span><span class="p">())</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/indexing.py:799,</span> in <span class="ni">CopyOnWriteArray.get_duck_array</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">798</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_duck_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">799</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">get_duck_array</span><span class="p">()</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/indexing.py:654,</span> in <span class="ni">LazilyIndexedArray.get_duck_array</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">650</span>     <span class="n">array</span> <span class="o">=</span> <span class="n">apply_indexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">651</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">652</span>     <span class="c1"># If the array is not an ExplicitlyIndexedNDArrayMixin,</span>
<span class="g g-Whitespace">    </span><span class="mi">653</span>     <span class="c1"># it may wrap a BackendArray so use its __getitem__</span>
<span class="ne">--&gt; </span><span class="mi">654</span>     <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span> <span class="c1"># self.array[self.key] is now a numpy array when</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span> <span class="c1"># self.array is a BackendArray subclass</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span> <span class="c1"># and self.key is BasicIndexer((slice(None, None, None),))</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span> <span class="c1"># so we need the explicit check for ExplicitlyIndexed</span>
<span class="g g-Whitespace">    </span><span class="mi">660</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">ExplicitlyIndexed</span><span class="p">):</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/backends/netCDF4_.py:103,</span> in <span class="ni">NetCDF4ArrayWrapper.__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">103</span>     <span class="k">return</span> <span class="n">indexing</span><span class="o">.</span><span class="n">explicit_indexing_adapter</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span>         <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">indexing</span><span class="o">.</span><span class="n">IndexingSupport</span><span class="o">.</span><span class="n">OUTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>     <span class="p">)</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/core/indexing.py:1023,</span> in <span class="ni">explicit_indexing_adapter</span><span class="nt">(key, shape, indexing_support, raw_indexing_method)</span>
<span class="g g-Whitespace">   </span><span class="mi">1001</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Support explicit indexing by delegating to a raw indexing method.</span>
<span class="g g-Whitespace">   </span><span class="mi">1002</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span><span class="sd"> Outer and/or vectorized indexers are supported by indexing a second time</span>
<span class="sd">   (...)   1020 Indexing result, in the form of a duck numpy-array.</span>
<span class="g g-Whitespace">   </span><span class="mi">1021</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span> <span class="n">raw_key</span><span class="p">,</span> <span class="n">numpy_indices</span> <span class="o">=</span> <span class="n">decompose_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">indexing_support</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1023</span> <span class="n">result</span> <span class="o">=</span> <span class="n">raw_indexing_method</span><span class="p">(</span><span class="n">raw_key</span><span class="o">.</span><span class="n">tuple</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="k">if</span> <span class="n">numpy_indices</span><span class="o">.</span><span class="n">tuple</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1025</span>     <span class="c1"># index the loaded duck array</span>
<span class="g g-Whitespace">   </span><span class="mi">1026</span>     <span class="n">indexable</span> <span class="o">=</span> <span class="n">as_indexable</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">File ~/code/data_analysis/lib/python3.12/site-packages/xarray/backends/netCDF4_.py:116,</span> in <span class="ni">NetCDF4ArrayWrapper._getitem</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span>         <span class="n">original_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="n">needs_lock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">116</span>         <span class="n">array</span> <span class="o">=</span> <span class="n">getitem</span><span class="p">(</span><span class="n">original_array</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span> <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span>     <span class="c1"># Catch IndexError in netCDF4 and return a more informative</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>     <span class="c1"># error message.  This is most often called when an unsorted</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span>     <span class="c1"># indexer is used before the data is loaded from disk.</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span>     <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span>         <span class="s2">&quot;The indexing operation you are attempting to perform &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span>         <span class="s2">&quot;is not valid on netCDF4.Variable object. Try loading &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>         <span class="s2">&quot;your data into memory first by calling .load().&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">empirical_cdf</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute x and y for plotting empirical CDF.&quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_errs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span>
<span class="n">df_errs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute CDFs</span>
<span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span> <span class="o">=</span> <span class="n">empirical_cdf</span><span class="p">(</span><span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;a_err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span> <span class="o">=</span> <span class="n">empirical_cdf</span><span class="p">(</span><span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;b_err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

<span class="c1"># Create Bokeh plot</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Relative Error (%)&quot;</span><span class="p">,</span>
    <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Empirical CDF&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Empirical CDFs of Quantile-based MSE and Std Dev Errors&quot;</span>
<span class="p">)</span>

<span class="n">line_a</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;(Booker &amp; Snelder 2012, 2014)&quot;</span><span class="p">)</span>
<span class="n">line_b</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;(Castellarin et al. 2007)&quot;</span><span class="p">)</span>

<span class="c1"># Optional: fine tune</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;bottom_right&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;sample_std&#39;</span><span class="p">],</span> <span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;a_err&#39;</span><span class="p">]</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;sample_std&#39;</span><span class="p">],</span> <span class="n">df_errs</span><span class="p">[</span><span class="s1">&#39;b_err&#39;</span><span class="p">]</span>
<span class="c1"># x_b, y_b = empirical_cdf(df_errs[&#39;b_err&#39;].dropna())</span>

<span class="c1"># Create Bokeh plot</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Sample Stdev.&quot;</span><span class="p">,</span>
    <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Relative Error (%)&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                   <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;(Booker &amp; Snelder 2012, 2014)&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                   <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;(Castellarin et al. 2007)&quot;</span><span class="p">)</span>

<span class="c1"># Optional: fine tune</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;bottom_right&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="4_Reference_Distributions.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Reference Distributions</p>
      </div>
    </a>
    <a class="right-next"
       href="6_Large_Sample_Results_Comparison.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Large Sample Comparison Results</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-simulation">5.1. Non-Parametric Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-based-ensemble">5.1.1. Time-based ensemble</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-based-ensembles">5.1.2. Frequency-based ensembles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-on-k-nearest-neighbours">5.2. Notes on k-nearest neighbours</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-set-theoretic-foundations-of-strict-k-nn-concurrency-selection">5.2.1. Summary: Set-Theoretic Foundations of Strict k-NN Concurrency Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-theoretic-definition">5.2.1.1. Set-Theoretic Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#related-concepts">5.2.1.2. Related Concepts</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implication">5.2.1.3. Practical Implication</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-universal-parametric-prior">5.3. Define a universal parametric prior</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-uniform-prior">5.3.1. Global Uniform Prior</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-case-of-bad-kde-fit-due-to-sparse-support-and-precision-vestiges">5.4. Example case of bad KDE fit due to sparse support and precision vestiges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-complexity-of-searching-the-space-of-k-nearest-neighbours-for-the-optimal-ensemble">5.4.1. Compute the complexity of searching the space of k-nearest neighbours for the optimal ensemble</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-how-biased-a-quantile-based-spread-estimate-is-at-different-resolutions">5.4.2. Evaluate how biased a quantile-based spread estimate is at different resolutions</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dan Kovacek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>